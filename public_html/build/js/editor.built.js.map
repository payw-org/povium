{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./resources/assets/js/editor/main.js","webpack:///./resources/assets/js/editor/PostEditor.js","webpack:///./resources/assets/js/editor/DOMManager.js","webpack:///./resources/assets/js/editor/SelectionManager.js","webpack:///./resources/assets/js/editor/PoviumNode.js"],"names":["editor","PostEditor","document","querySelector","addEventListener","sel","window","getSelection","rangeCount","range","getRangeAt","console","log","startContainer","startOffset","endContainer","endOffset","selManager","getAllNodesInSelection","splitElementNode2","splitTextNode","getSelectionPosition","getSelectionPositionInParagraph","editorDOM","self","domManager","DOMManager","SelectionManager","mouseDownStart","execCommand","onSelectionChanged","isBackspaceKeyPressed","e","onKeyDown","onKeyUp","onKeyPress","onPaste","body","heading","heading1","heading2","heading3","boldButton","bold","italicButton","italic","underlineButton","underline","strikeButton","strike","alignLeft","align","alignCenter","alignRight","orderedList","list","blockquote","initEditor","clipboardData","pastedData","stopPropagation","preventDefault","getData","paste","currentNode","getNodeInSelection","textContent","removeChild","contains","warn","keyCode","which","backspace","delete","enter","fixSelection","emptyNode","createElement","innerHTML","style","opacity","appendChild","createRange","setStart","firstChild","setEnd","replaceRange","removeAllRanges","contentInside","childNodesCount","length","pHolder","toolbar","unorderedList","link","tagName","elm","br","firstNode","secondNode","front","back","nodeName","nodeType","direction","chunks","node","i","isParagraph","isHeading","textAlign","type","orgRange","getRange","startNode","endNode","changedNode","changeNodeName","keepRange","listElm","placedListElm","placedListElmIndex","unlockList","recordList","itemElm","parentNode","isList","includes","push","childElementCount","replaceChild","itemNode","nextNode","part1","part2","part3","part1ListElm","part3ListElm","part1ListElmInserted","part3ListElmInserted","part3Will","setStartAfter","nextElementSibling","insertNode","pElm","url","isAllBlockquote","collapsed","removeSelection","isAvailableChildNode","isAvailableParentNode","getPreviousAvailableNode","previousNode","lastChild","querySelectorAll","mergeNodes","getNextAvailableNode","setStartBefore","selectionNode","selPosType","splitElementNode","generateEmptyNode","insertBefore","newNodeName","nextSibling","isBlockquote","isListItem","isEmptyNode","collapse","splitted","split","forEach","paragraph","index","addedNode","line","createTextNode","replace","addRange","targetNode","keepStyle","newNode","orgS","orgSO","orgE","orgEO","target","newRange","isChanged","firstElementChild","travelNode","isTextContainNode","normalize","frontNode","backNode","backNodePassed","tempNode","orgNode","count","parentElement","previousSibling","isTextStyleNode","undefined","first","second","matchTopNode","nextFront","nextBack","getTextNodeInElementNode","returnNode","splitText","collapseDirection","cloneRange","splitResult","deletionDone","nextParentNode","currentParentNode","metCurrentNode","tempRange","setEndAfter","deleteContents","isTextEmptyNode","createEvent","isCollapsed","isBold","isItalics","isStrike","isUnderline","isLink","classList","isImageBlock","firstOrLast","error","customRange","isStart","isEnd","nodes","itemNodes","Node","prototype","merge"],"mappings":"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","file":"editor.built.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n","import PostEditor from \"./PostEditor\";\nimport \"./PoviumNode\";\n\nconst editor = new PostEditor(document.querySelector('#post-editor'));\n\n// var a = document.createElement('h1').nodeName;\n// console.log(a);\n\ndocument.querySelector('#log-range').addEventListener('click', function () {\n\n\tvar sel = window.getSelection();\n\n\tif (sel.rangeCount === 0) {\n\t\treturn;\n\t}\n\n\tvar range = sel.getRangeAt(0);\n\n\tconsole.log(range.startContainer);\n\tconsole.log(range.startOffset);\n\tconsole.log(range.endContainer);\n\tconsole.log(range.endOffset);\n\n});\n\ndocument.querySelector('#nodes-in-selection').addEventListener('click', function () {\n\n\tconsole.log(editor.selManager.getAllNodesInSelection());\n\n});\n\ndocument.querySelector('#separate').addEventListener('click', function () {\n\n\teditor.selManager.splitElementNode2();\n\n});\n\ndocument.querySelector('#split-text').addEventListener('click', function () {\n\n\teditor.selManager.splitTextNode();\n\n});\n\ndocument.querySelector('#get-sel-pos').addEventListener('click', function () {\n\n\tconsole.log(editor.selManager.getSelectionPosition());\n\n});\n\ndocument.querySelector('#get-sel-pos-par').addEventListener('click', function () {\n\n\tconsole.log(editor.selManager.getSelectionPositionInParagraph());\n\n});\n\n\n// var dom = document.createElement(\"ol\");\n// dom.innerHTML = \"<li></li>\";\n// console.log(editor.selManager.isEmptyNode(dom));\n// console.log(editor.selManager.isTextEmptyNode(dom));","import DOMManager from \"./DOMManager\";\nimport SelectionManager from \"./SelectionManager\";\n\nexport default class PostEditor {\n\n\t/**\n\t * Creates a new PostEditor object.\n\t * @param {HTMLElement} editorDOM\n\t */\n\tconstructor (editorDOM) {\n\n\t\tlet self = this;\n\n\t\tthis.domManager = new DOMManager(editorDOM);\n\t\tthis.selManager = new SelectionManager(this.domManager);\n\n\t\tthis.mouseDownStart = false;\n\n\t\tdocument.execCommand(\"defaultParagraphSeparator\", false, \"p\");\n\n\t\t// Event Listeners\n\n\t\tthis.domManager.editor.addEventListener('click', () => { this.onSelectionChanged(); });\n\n\t\tthis.domManager.editor.addEventListener('mousedown', () => {\n\t\t\tthis.mouseDownStart = true;\n\t\t});\n\t\twindow.addEventListener('mouseup', () => {\n\t\t\tif (this.mouseDownStart) {\n\t\t\t\tthis.mouseDownStart = false;\n\t\t\t\t// this.onSelectionChanged();\n\t\t\t}\n\t\t\t\n\t\t});\n\n\n\t\tthis.isBackspaceKeyPressed = false;\n\n\t\twindow.addEventListener('keydown', (e) => {\n\t\t\tthis.onKeyDown(e);\n\t\t\tthis.onSelectionChanged();\n\t\t});\n\t\tthis.domManager.editor.addEventListener('keyup', (e) => {\n\t\t\tthis.onKeyUp(e);\n\t\t\t\n\t\t\tthis.onSelectionChanged();\n\t\t});\n\t\tthis.domManager.editor.addEventListener('keypress', (e) => {\n\t\t\tthis.onKeyPress(e);\n\t\t});\n\n\t\tthis.domManager.editor.addEventListener('paste', (e) => { this.onPaste(e); });\n\n\t\t// Toolbar button events\n\t\tthis.domManager.body.addEventListener('click', (e) => { this.selManager.heading('P'); });\n\t\tthis.domManager.heading1.addEventListener('click', (e) => { this.selManager.heading('H1'); });\n\t\tthis.domManager.heading2.addEventListener('click', (e) => { this.selManager.heading('H2'); });\n\t\tthis.domManager.heading3.addEventListener('click', (e) => { this.selManager.heading('H3'); });\n\n\t\tthis.domManager.boldButton.addEventListener('click', (e) => { this.selManager.bold(); });\n\t\tthis.domManager.italicButton.addEventListener('click', (e) => { this.selManager.italic(); });\n\t\tthis.domManager.underlineButton.addEventListener('click', (e) => { this.selManager.underline(); });\n\t\tthis.domManager.strikeButton.addEventListener('click', (e) => { this.selManager.strike(); });\n\n\t\tthis.domManager.alignLeft.addEventListener('click', (e) => { this.selManager.align('left'); });\n\t\tthis.domManager.alignCenter.addEventListener('click', (e) => { this.selManager.align('center'); });\n\t\tthis.domManager.alignRight.addEventListener('click', (e) => { this.selManager.align('right'); });\n\n\t\tthis.domManager.orderedList.addEventListener('click', (e) => { this.selManager.list('OL'); });\n\t\t// this.domManager.unorderedList.addEventListener('click', (e) => { this.selManager.list('UL'); });\n\t\tthis.domManager.blockquote.addEventListener('click', (e) => { this.selManager.blockquote('UL'); });\n\n\t\tthis.initEditor();\n\n\t}\n\n\t// Events\n\n\t\n\n\t/**\n\t *\n\t * @param {KeyboardEvent} e\n\t */\n\tonPaste (e) {\n\n\t\tlet clipboardData, pastedData;\n\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\n\t\t// Get data from clipboard and conver\n\t\tclipboardData = e.clipboardData || window.clipboardData;\n\t\tpastedData = clipboardData.getData('Text');\n\n\t\tthis.selManager.paste(pastedData);\n\n\t}\n\n\n\tonKeyPress (e) {\n\n\t}\n\n\t/**\n\t * Fires when press keyboard inside the editor.\n\t * @param {KeyboardEvent} e \n\t */\n\tonKeyUp (e) {\n\t\tvar currentNode = this.selManager.getNodeInSelection();\n\t\tif (currentNode && currentNode.textContent !== \"\" && currentNode.querySelector(\"br\")) {\n\t\t\tcurrentNode.removeChild(currentNode.querySelector(\"br\"));\n\t\t}\n\t}\n\n\tonKeyDown (e) {\n\n\t\tvar sel = window.getSelection();\n\t\tif (sel.rangeCount > 0) {\n\t\t\tif (!this.domManager.editor.contains(sel.getRangeAt(0).startContainer)) {\n\t\t\t\tconsole.warn(\"The given range is not in the editor. Editor's features will work only inside the editor.\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tvar keyCode = e.which;\n\n\t\t// Delete key\n\t\tif (keyCode === 8) {\n\n\t\t\tthis.selManager.backspace(e);\n\n\t\t} else if (keyCode === 46) {\n\t\t\tconsole.log(\"delete\");\n\t\t\tthis.selManager.delete(e);\n\t\t} else if (keyCode === 13) {\n\n\t\t\tthis.selManager.enter(e);\n\t\t\t\n\t\t}\n\t\t\n\t}\n\n\n\tonSelectionChanged () {\n\n\t\t// console.log('selection has been changed');\n\n\t\t\n\t\tthis.selManager.fixSelection();\t\t\n\n\t}\n\n\n\t// Methods\n\n\t/**\n\t * Initialize editor.\n\t */\n\tinitEditor () {\n\n\t\t// Fix flickering when add text style first time\n\t\t// in Chrome browser.\n\t\tvar emptyNode = document.createElement('p');\n\t\temptyNode.innerHTML = 'a';\n\t\temptyNode.style.opacity = '0';\n\t\tthis.domManager.editor.appendChild(emptyNode);\n\t\tvar range = document.createRange();\n\t\trange.setStart(emptyNode.firstChild, 0);\n\t\trange.setEnd(emptyNode.firstChild, 1);\n\t\tthis.selManager.replaceRange(range);\n\t\tdocument.execCommand('bold', false);\n\t\tthis.domManager.editor.removeChild(emptyNode);\n\t\tdocument.getSelection().removeAllRanges();\n\n\t\t// if (this.isEmpty()) {\n\t\t// \tthis.domManager.editor.innerHTML = \"\";\n\t\t// \tvar emptyP = this.domManager.generateEmptyParagraph('p');\n\t\t// \tthis.domManager.editor.appendChild(emptyP);\n\n\t\t// \tvar range = document.createRange();\n\t\t// \trange.setStartBefore(emptyP);\n\t\t// \trange.collapse(true);\n\n\t\t// \tthis.selManager.sel.removeAllRanges();\n\t\t// \tthis.selManager.sel.addRange(range);\n\t\t// }\n\t\t\n\t}\n\n\tclearEditor () {\n\n\t\tthis.domManager.editor.innerHTML = \"\";\n\n\t}\n\t\n\n\t/**\n\t * Return true if the editor is empty.\n\t */\n\tisEmpty () {\n\t\tlet contentInside = this.domManager.editor.textContent;\n\t\tlet childNodesCount = this.selManager.getAllNodesInSelection().length;\n\t\tif (contentInside === \"\" && childNodesCount < 1) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n}\n","export default class DOMManager {\n\n\t/**\n\t * Manages html DOM.\n\t * @param {HTMLElement} editorDOM\n\t */\n\tconstructor (editorDOM) {\n\n\t\tthis.pHolder = document.createElement('p');\n\t\tthis.pHolder.innerHTML = '<br>';\n\n\t\t// Editor body\n\t\tthis.editor = editorDOM.querySelector('#editor-body');\n\n\t\t// Toolbar\n\t\tthis.toolbar = editorDOM.querySelector('#editor-toolbar');\n\n\t\t// Toolbar buttons\n\t\tthis.body = this.toolbar.querySelector('#p');\n\t\tthis.heading1 = this.toolbar.querySelector('#h1');\n\t\tthis.heading2 = this.toolbar.querySelector('#h2');\n\t\tthis.heading3 = this.toolbar.querySelector('#h3');\n\n\t\tthis.boldButton = this.toolbar.querySelector('#bold');\n\t\tthis.italicButton = this.toolbar.querySelector('#italic');\n\t\tthis.underlineButton = this.toolbar.querySelector('#underline');\n\t\tthis.strikeButton = this.toolbar.querySelector('#strike');\n\n\t\tthis.alignLeft = this.toolbar.querySelector('#align-left');\n\t\tthis.alignCenter = this.toolbar.querySelector('#align-center');\n\t\tthis.alignRight = this.toolbar.querySelector('#align-right');\n\n\t\tthis.orderedList = this.toolbar.querySelector('#ol');\n\t\tthis.unorderedList = this.toolbar.querySelector('#ul');\n\n\t\tthis.link = this.toolbar.querySelector('#link');\n\t\tthis.blockquote = this.toolbar.querySelector('#blockquote');\n\n\t}\n\n\t/**\n\t * \n\t * @param  {String} tagName\n\t * @return {HTMLElement}\n\t */\n\tgenerateEmptyNode (tagName) {\n\t\tvar elm = document.createElement(tagName);\n\t\tvar br = document.createElement('br');\n\t\telm.appendChild(br);\n\t\treturn elm;\n\t}\n\n\t/**\n\t * Merge two nodes into one node.\n\t * @param {Node} firstNode \n\t * @param {Node} secondNode \n\t */\n\tmergeNodes (firstNode, secondNode) {\n\t\t\n\t\tif (firstNode === null || secondNode === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar front = firstNode, back = secondNode;\n\n\t\twhile (1) {\n\n\t\t\tif (front.nodeName !== back.nodeName) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (front.nodeType === 3) {\n\n\t\t\t\t\n\n\t\t\t} else {\n\n\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}","export default class SelectionManager\n{\n\n\t/**\n\t * \n\t * @param {DOMManager} domManager\n\t */\n\tconstructor(domManager)\n\t{\n\n\t\tthis.domManager = domManager;\n\n\t}\n\n\t// Events\n\n\n\n\t// Methods\n\n\t/**\n\t * Align the selected paragraph.\n\t * @param {String} direction\n\t * Left, Center, Right\n\t */\n\talign(direction)\n\t{\n\n\t\t// document.execCommand('styleWithCSS', true);\n\t\t// document.execCommand(direction, false);\n\n\t\tvar chunks = this.getAllNodesInSelection();\n\t\tvar node;\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\tif (!this.isParagraph(chunks[i]) && !this.isHeading(chunks[i])) {\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tchunks[i].style.textAlign = direction;\n\n\t\t}\n\t\t\n\t}\n\n\n\t/**\n\t * Make the selection bold.\n\t */\n\tbold()\n\t{\n\t\tdocument.execCommand('bold', false);\n\t}\n\n\t/**\n\t * Make the selection italics.\n\t */\n\titalic()\n\t{\n\t\tdocument.execCommand('italic', false);\n\t}\n\n\tunderline()\n\t{\n\t\tdocument.execCommand('underline', false);\n\t}\n\n\tstrike()\n\t{\n\t\tdocument.execCommand('strikeThrough', false);\n\t}\n\n\t/**\n\t * \n\t * @param {string} type \n\t */\n\theading(type)\n\t{\n\n\t\t// # \n\t\t//         \n\t\t// heading   range  . range document  .\n\t\t// ->   heading  .\n\t\t\n\t\tlet orgRange = this.getRange();\n\t\tif (!orgRange) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet startNode = orgRange.startContainer;\n\t\tlet startOffset = orgRange.startOffset;\n\t\tlet endNode = orgRange.endContainer;\n\t\tlet endOffset = orgRange.endOffset;\n\t\tlet chunks = this.getAllNodesInSelection();\n\n\t\t\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\tif (chunks[i].nodeName === type) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// if (chunks[i].textContent === \"\") {\n\t\t\t// \tcontinue;\n\t\t\t// }\n\n\t\t\tif (\n\t\t\t\t!this.isParagraph(chunks[i]) &&\n\t\t\t\t!this.isHeading(chunks[i])\n\t\t\t) {\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar changedNode = this.changeNodeName(chunks[i], type);\n\t\t\tif (chunks[i] === startNode) {\n\t\t\t\tstartNode = changedNode;\n\t\t\t}\n\t\t\tif (chunks[i] === endNode) {\n\t\t\t\tendNode = changedNode;\n\t\t\t}\n\n\t\t}\n\n\t\t\n\t\tvar keepRange = document.createRange();\n\t\tkeepRange.setStart(startNode, startOffset);\n\t\tkeepRange.setEnd(endNode, endOffset);\n\t\tthis.replaceRange(keepRange);\n\n\t}\n\n\t/**\n\t * \n\t * @param {string} type \n\t */\n\tlist(type)\n\t{\n\n\t\t// If one or more lists are\n\t\t// included in the selection,\n\t\t// add other chunks to the existing list.\n\n\t\t// If all selection is already a list\n\t\t// restore them to 'P' node.\n\n\t\tlet orgRange = this.getRange();\n\t\tif (!orgRange) {\n\t\t\treturn;\n\t\t}\n\t\tlet startNode = orgRange.startContainer;\n\t\tlet startOffset = orgRange.startOffset;\n\t\tlet endNode = orgRange.endContainer;\n\t\tlet endOffset = orgRange.endOffset;\n\n\t\tlet chunks = this.getAllNodesInSelection();\n\t\tlet listElm = document.createElement(type);\n\t\tvar placedListElm = false;\n\t\tvar placedListElmIndex;\n\t\tvar node;\n\n\t\tvar unlockList = true;\n\t\tvar recordList = [];\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\t// if (chunks[i].textContent === \"\") {\n\t\t\t// \tcontinue;\n\t\t\t// }\n\n\t\t\tif (\n\t\t\t\tthis.isParagraph(chunks[i]) ||\n\t\t\t\tthis.isHeading(chunks[i])\n\t\t\t) {\n\n\t\t\t\tvar itemElm = document.createElement('LI');\n\n\t\t\t\twhile (node = chunks[i].firstChild) {\n\n\t\t\t\t\titemElm.appendChild(node);\n\n\t\t\t\t}\n\n\t\t\t\tif (chunks[i] === startNode) {\n\t\t\t\t\tstartNode = itemElm;\n\t\t\t\t}\n\t\n\t\t\t\tif (chunks[i] === endNode) {\n\t\t\t\t\tendNode = itemElm;\n\t\t\t\t}\n\n\t\t\t\tlistElm.appendChild(itemElm);\n\n\t\t\t\tif (!placedListElm) {\n\t\t\t\t\tplacedListElmIndex = i;\n\t\t\t\t\tplacedListElm = true;\n\t\t\t\t} else {\n\t\t\t\t\tchunks[i].parentNode.removeChild(chunks[i]);\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t\tunlockList = false;\n\n\t\t\t} else if (this.isList(chunks[i])) {\n\n\t\t\t\t// If the node is already a list\n\t\t\t\t// move items inside to the new list element.\n\n\t\t\t\tif (!recordList.includes(chunks[i])) {\n\t\t\t\t\trecordList.push(chunks[i]);\n\t\t\t\t}\n\n\t\t\t\tif (recordList.length > 1) {\n\t\t\t\t\tunlockList = false;\n\t\t\t\t}\n\n\t\t\t\twhile (node = chunks[i].firstChild) {\n\n\t\t\t\t\tlistElm.appendChild(node);\n\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t\tif (!placedListElm) {\n\t\t\t\t\tplacedListElmIndex = i;\n\t\t\t\t\tplacedListElm = true;\n\t\t\t\t} else {\n\t\t\t\t\tchunks[i].parentNode.removeChild(chunks[i]);\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif (listElm.childElementCount < 1) {\n\t\t\treturn;\n\t\t}\n\n\t\t// this.getRange().insertNode(listElm);\n\t\tchunks[0].parentNode.replaceChild(listElm, chunks[placedListElmIndex]);\n\n\t\tif (unlockList) {\n\n\t\t\tvar range = document.createRange();\n\t\t\tvar itemNode, nextNode;\n\t\t\tvar part1 = true, part2 = false, part3 = false;\n\t\t\tvar part1ListElm = document.createElement(type), part3ListElm = document.createElement(type);\n\t\t\tvar part1ListElmInserted = false, part3ListElmInserted = false;\n\t\t\tvar part3Will = false;\n\n\t\t\trange.setStartAfter(listElm);\n\t\t\tthis.replaceRange(range);\n\n\t\t\titemNode = listElm.firstChild;\n\t\t\tnextNode = itemNode;\n\n\t\t\twhile (itemNode) {\n\n\t\t\t\tnextNode = itemNode.nextElementSibling;\n\n\t\t\t\tif (itemNode.nodeName !== \"LI\") {\n\t\t\t\t\titemNode = itemNode.nextElementSibling;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (itemNode.contains(startNode)) {\n\t\t\t\t\tpart1 = false;\n\t\t\t\t\tpart2 = true;\n\t\t\t\t\tpart3 = false;\n\t\t\t\t}\n\n\t\t\t\tif (itemNode.contains(endNode)) {\n\t\t\t\t\tpart3Will = true;\n\t\t\t\t}\n\n\n\n\n\n\t\t\t\tif (part1) {\n\n\t\t\t\t\tpart1ListElm.appendChild(itemNode);\n\n\t\t\t\t\tif (!part1ListElmInserted) {\n\t\t\t\t\t\trange.insertNode(part1ListElm);\n\t\t\t\t\t\trange.setStartAfter(part1ListElm);\n\t\t\t\t\t\tpart1ListElmInserted = true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if (part2) {\n\n\t\t\t\t\tvar pElm = document.createElement('P');\n\t\t\t\t\twhile (node = itemNode.firstChild) {\n\t\t\t\t\t\tpElm.appendChild(node)\n\t\t\t\t\t}\n\n\t\t\t\t\trange.insertNode(pElm);\n\t\t\t\t\trange.setStartAfter(pElm);\n\n\t\t\t\t} else if (part3) {\n\n\t\t\t\t\tpart3ListElm.appendChild(itemNode);\n\t\t\t\t\t\n\t\t\t\t\tif (!part3ListElmInserted) {\n\t\t\t\t\t\trange.insertNode(part3ListElm);\n\t\t\t\t\t\trange.setStartAfter(part3ListElm);\n\t\t\t\t\t\tpart3ListElmInserted = true;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif (itemNode === startNode) {\n\t\t\t\t\tstartNode = pElm;\n\t\t\t\t}\n\t\n\t\t\t\tif (itemNode === endNode) {\n\t\t\t\t\tendNode = pElm;\n\t\t\t\t}\n\n\t\t\t\n\n\t\t\t\tif (part3Will) {\n\t\t\t\t\tpart1 = false;\n\t\t\t\t\tpart2 = false;\n\t\t\t\t\tpart3 = true;\n\t\t\t\t}\n\t\t\t\n\n\t\t\t\titemNode = nextNode;\n\n\n\t\t\t}\n\n\t\t\tif (this.domManager.editor.contains(listElm)) {\n\t\t\t\tthis.domManager.editor.removeChild(listElm);\n\t\t\t}\n\t\t\t\n\n\t\t}\n\n\t\tconsole.log(startNode, endNode);\n\n\t\tvar keepRange = document.createRange();\n\t\tkeepRange.setStart(startNode, startOffset);\n\t\tkeepRange.setEnd(endNode, endOffset);\n\n\t\tthis.replaceRange(keepRange);\n\n\t\tthis.fixSelection();\n\n\t}\n\n\tlink(url)\n\t{\n\t\tdocument.execCommand('createLink', false, url);\n\t}\n\n\tblockquote()\n\t{\n\t\tlet orgRange = this.getRange();\n\t\tif (!orgRange) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet startNode = orgRange.startContainer;\n\t\tlet startOffset = orgRange.startOffset;\n\t\tlet endNode = orgRange.endContainer;\n\t\tlet endOffset = orgRange.endOffset;\n\t\tlet chunks = this.getAllNodesInSelection();\n\n\t\tvar isAllBlockquote = true;\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\tif (chunks[i].nodeName === \"BLOCKQUOTE\") {\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tisAllBlockquote = false;\n\t\t\t}\n\n\t\t\t// if (chunks[i].textContent === \"\") {\n\t\t\t// \tcontinue;\n\t\t\t// }\n\n\t\t\tif (!this.isParagraph(chunks[i]) && !this.isHeading(chunks[i])) {\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar changedNode = this.changeNodeName(chunks[i], \"blockquote\", false);\n\t\t\tif (chunks[i] === startNode) {\n\t\t\t\tstartNode = changedNode;\n\t\t\t}\n\t\t\tif (chunks[i] === endNode) {\n\t\t\t\tendNode = changedNode;\n\t\t\t}\n\n\t\t}\n\n\t\t// Selection is all blockquote\n\t\tif (isAllBlockquote) {\n\t\t\tfor (var i = 0; i < chunks.length; i++) {\n\t\t\t\tvar changedNode = this.changeNodeName(chunks[i], \"P\", false);\n\t\t\t\tif (chunks[i] === startNode) {\n\t\t\t\t\tstartNode = changedNode;\n\t\t\t\t}\n\t\t\t\tif (chunks[i] === endNode) {\n\t\t\t\t\tendNode = changedNode;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tvar keepRange = document.createRange();\n\t\tkeepRange.setStart(startNode, startOffset);\n\t\tkeepRange.setEnd(endNode, endOffset);\n\t\tthis.replaceRange(keepRange);\n\t}\n\n\n\t/**\n\t * Backspace implementation\n\t */\n\tbackspace(e)\n\t{\n\n\t\t// Get current available node\n\t\tvar currentNode = this.getNodeInSelection();\n\n\t\tvar range = this.getRange();\n\t\tif (!range.collapsed) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tthis.removeSelection(\"start\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Backspace key - Empty node\n\t\tif (currentNode && currentNode.textContent.length === 0) {\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getPreviousAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tvar previousNode = this.getPreviousAvailableNode(currentNode);\n\n\t\t\t\tconsole.log(\"empty child node or parent node\");\n\n\t\t\t\tif (previousNode) {\n\t\t\t\t\tvar range = document.createRange();\n\t\t\t\t\trange.setStartAfter(previousNode.lastChild);\n\t\t\t\t\tthis.replaceRange(range);\n\n\t\t\t\t\tif (this.isAvailableChildNode(currentNode)) {\n\t\t\t\t\t\tvar parentNode = currentNode.parentNode;\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t\tconsole.log(parentNode.querySelectorAll(\"LI\"));\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tvar range = document.createRange();\n\t\t\t\trange.setStart(currentNode, 0);\n\t\t\t\trange.setEnd(currentNode, 0);\n\t\t\t\tthis.replaceRange(range);\n\t\t\t}\n\n\t\t} else if (currentNode && this.getSelectionPositionInParagraph() === 1) {\n\n\t\t\t// Delete key - caret position at start of the node\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconsole.log(\"move this line to previous line\");\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getPreviousAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tconsole.log(\"child node or parentnode\");\n\n\t\t\t\tvar previousNode = this.getPreviousAvailableNode(currentNode);\n\n\t\t\t\tif (previousNode) {\n\n\t\t\t\t\tvar node, orgRange = this.getRange();\n\n\t\t\t\t\tvar startNode = orgRange.startContainer, startOffset = orgRange.startOffset;\n\t\t\t\t\tvar endNode = orgRange.endContainer, endOffset = orgRange.endOffset;\n\n\t\t\t\t\tvar br = previousNode.querySelector(\"br\");\n\t\t\t\t\tif (br) {\n\t\t\t\t\t\tbr.parentNode.removeChild(br);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isAvailableChildNode(currentNode)) {\n\t\t\t\t\t\tvar parentNode = currentNode.parentNode;\n\t\t\t\t\t\tthis.mergeNodes(previousNode, currentNode, true);\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.mergeNodes(previousNode, currentNode, true);\n\t\t\t\t\t}\n\n\t\t\t\t\t\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t\t\n\n\t}\n\n\tdelete(e)\n\t{\n\t\t// Get current available node\n\t\tvar currentNode = this.getNodeInSelection();\n\n\t\tvar range = this.getRange();\n\t\tif (!range.collapsed) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tthis.removeSelection(\"start\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Delete key - Empty node\n\t\tif (currentNode && currentNode.textContent.length === 0) {\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getNextAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tvar nextNode = this.getNextAvailableNode(currentNode);\n\n\t\t\t\tconsole.log(\"empty child node or parent node\");\n\n\t\t\t\tif (nextNode) {\n\t\t\t\t\tvar range = document.createRange();\n\t\t\t\t\trange.setStartBefore(nextNode.firstChild);\n\t\t\t\t\tthis.replaceRange(range);\n\n\t\t\t\t\tif (this.isAvailableChildNode(currentNode)) {\n\t\t\t\t\t\tvar parentNode = currentNode.parentNode;\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tvar range = document.createRange();\n\t\t\t\trange.setStart(currentNode, 0);\n\t\t\t\trange.setEnd(currentNode, 0);\n\t\t\t\tthis.replaceRange(range);\n\t\t\t}\n\n\t\t} else if (currentNode && this.getSelectionPositionInParagraph() === 3) {\n\n\t\t\t// Delete key - caret position at start of the node\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconsole.log(\"pull the next node to current.\");\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getNextAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tvar nextNode = this.getNextAvailableNode(currentNode);\n\n\t\t\t\tif (nextNode) {\n\n\t\t\t\t\tvar br = nextNode.querySelector(\"br\");\n\t\t\t\t\tif (br) {\n\t\t\t\t\t\tbr.parentNode.removeChild(br);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isAvailableChildNode(nextNode)) {\n\t\t\t\t\t\tvar parentNode = nextNode.parentNode;\n\t\t\t\t\t\tthis.mergeNodes(currentNode, nextNode, true);\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.mergeNodes(currentNode, nextNode, true);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t}\n\n\n\t/**\n\t * Prevents default action and implements a return(enter) key press.\n\t */\n\tenter(e)\n\t{\n\t\t\n\n\t\t// When press return key\n\t\tvar selectionNode = this.getNodeInSelection();\n\t\tvar range = this.getRange();\n\t\tif (!range.collapsed) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tthis.removeSelection();\n\t\t\t// this.backspace(e);\n\t\t\tconsole.log(this.getRange());\n\t\t\tconsole.log(\"the range is not collapsed\");\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log(selectionNode);\n\n\t\tvar selPosType = this.getSelectionPositionInParagraph();\n\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\n\t\tif (selPosType === 2) {\n\t\t\tconsole.log('middle');\n\t\t\tthis.splitElementNode();\n\t\t} else if (selPosType === 1) {\n\t\t\tconsole.log('start');\n\t\t\tvar pElm = this.domManager.generateEmptyNode(selectionNode.nodeName);\n\n\t\t\tselectionNode.parentNode.insertBefore(pElm, selectionNode);\n\t\t} else if (selPosType === 3) {\n\t\t\tconsole.log('end');\n\t\t\tvar newNodeName = selectionNode.nodeName;\n\t\t\tvar parentNode = selectionNode.parentNode;\n\t\t\tvar nextNode = selectionNode.nextSibling;\n\n\t\t\tif (this.isBlockquote(selectionNode)) {\n\t\t\t\tnewNodeName = \"P\";\n\t\t\t} else if (this.isListItem(selectionNode)) {\n\t\t\t\tif (this.isEmptyNode(selectionNode)) {\n\n\t\t\t\t\tif (!this.isListItem(this.getNextAvailableNode(selectionNode))) {\n\t\t\t\t\t\tnewNodeName = \"P\";\n\t\t\t\t\t\tselectionNode.parentNode.removeChild(selectionNode);\n\t\t\t\t\t\tnextNode = parentNode.nextSibling;\n\t\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar pElm = this.domManager.generateEmptyNode(newNodeName);\n\n\t\t\tconsole.log(pElm);\n\n\t\t\tconsole.log(parentNode);\n\n\t\t\tparentNode.insertBefore(pElm, nextNode);\n\n\t\t\tvar range = document.createRange();\n\t\t\trange.setStartBefore(pElm.firstChild);\n\t\t\trange.collapse(true);\n\n\t\t\tthis.replaceRange(range);\n\t\t}\n\n\n\t}\n\n\t/**\n\t * Paste refined data to the selection.\n\t * @param {String} pastedData\n\t */\n\tpaste(pastedData)\n\t{\n\n\t\tlet splitted = pastedData.split(/(?:\\r\\n|\\r|\\n)/g);\n\n\t\tvar range = document.createRange();\n\t\trange = this.getRange();\n\n\t\tsplitted.forEach( (paragraph, index) => {\n\n\t\t\tvar addedNode;\n\n\t\t\tvar line = paragraph;\n\n\t\t\tif (index === 0) {\n\t\t\t\t// line = line.replace(/\\s/g, \"&nbsp;\");\n\t\t\t\taddedNode = document.createTextNode(line);\n\t\t\t} else {\n\t\t\t\taddedNode = document.createElement('p');\n\t\t\t\tline = line.replace(/\\s/g, \"&nbsp;\");\n\t\t\t\tif (line === \"\") {\n\t\t\t\t\tline = \"<br>\";\n\t\t\t\t}\n\t\t\t\taddedNode.innerHTML = line;\n\t\t\t}\n\n\t\t\trange.insertNode(addedNode);\n\n\t\t\trange.setStartAfter(addedNode);\n\n\t\t});\n\n\t\t// console.log(splitted);\n\n\t\t// pastedData = pastedData.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n \n\t}\n\n\n\n\tclearRange()\n\t{\n\t\tdocument.getSelection().removeAllRanges();\n\t}\n\n\t/**\n\t * \n\t * @param {Range} range \n\t */\n\treplaceRange(range)\n\t{\n\t\tif (!range) {\n\t\t\tconsole.warn(\"range is not available.\", range);\n\t\t\treturn;\n\t\t}\n\t\tdocument.getSelection().removeAllRanges();\n\t\tdocument.getSelection().addRange(range);\n\t}\n\n\t/**\n\t * Replace the node if the node is inside the editor,\n\t * else return the new node.\n\t * @param {HTMLElement} targetNode An HTML element you want to change its node name.\n\t * @param {String} newNodeName New node name for the target element.\n\t */\n\tchangeNodeName(targetNode, newNodeName, keepStyle = true)\n\t{\n\n\t\t// Move all the nodes inside the target node\n\t\t// to the new generated node with new node name,\n\t\t// as well as preserving the range\n\t\t// if the startContainer or the endContainer are included\n\t\t// in the original node.\n\n\t\tif (targetNode.nodeType !== 1) {\n\t\t\t// If the node is not an HTML element do nothing.\n\t\t\treturn;\n\t\t}\n\n\t\t// 1. Change node\n\t\tvar node;\n\t\tvar newNode = document.createElement(newNodeName);\n\n\t\tif (keepStyle) {\n\t\t\tnewNode.style.textAlign = targetNode.style.textAlign;\n\t\t}\n\t\t\n\n\t\twhile (node = targetNode.firstChild) {\n\t\t\tnewNode.appendChild(node);\n\t\t}\n\n\t\t// 3. replace node\n\t\tthis.domManager.editor.replaceChild(newNode, targetNode);\n\n\t\treturn newNode;\n\n\t}\n\n\t/**\n\t * Update selection information.\n\t */\n\tupdateSelection()\n\t{\n\n\n\t}\n\n\tfixSelection()\n\t{\n\t\t\n\t\t// If the selection is not in the available elements\n\t\t// adjust it.\n\t\tvar range = this.getRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\n\t\tvar startNode = range.startContainer;\n\t\tvar startOffset = range.startOffset;\n\t\tvar endNode = range.endContainer;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar orgS = startNode;\n\t\tvar orgSO = startOffset;\n\t\tvar orgE = endNode;\n\t\tvar orgEO = endOffset;\n\n\t\tvar target;\n\n\t\tvar newRange = document.createRange();\n\t\tnewRange.setStart(startNode, startOffset);\n\t\tnewRange.setEnd(endNode, endOffset);\n\n\t\tvar isChanged = false;\n\n\t\t// if (startNode.id === 'editor-body') {\n\t\tif (startNode === this.domManager.editor) {\n\n\t\t\ttarget = startNode.firstElementChild;\n\n\t\t\tfor (var i = 0; i < startOffset; i++) {\n\t\t\t\ttarget = target.nextElementSibling;\n\t\t\t}\n\n\t\t\t\n\n\t\t\tif (target) {\n\n\t\t\t\tstartNode = target;\n\t\t\t\tnewRange.setStart(startNode, 0);\n\n\t\t\t\tisChanged = true;\n\t\t\t}\n\n\t\t\t\n\n\t\t}\n\n\n\t\t// if (endNode.id === 'editor-body') {\n\t\tif (endNode === this.domManager.editor) {\n\n\n\t\t\ttarget = endNode.firstChild;\n\n\t\t\tfor (var i = 0; i < endOffset - 1; i++) {\n\t\t\t\ttarget = target.nextElementSibling;\n\t\t\t}\n\n\t\t\tif (target) {\n\t\t\t\tendNode = target;\n\n\t\t\t\tnewRange.setEnd(endNode, 1);\n\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t\t\n\n\t\t}\n\n\n\n\t\tvar travelNode;\n\n\t\tif (this.isTextContainNode(startNode)) {\n\n\n\n\t\t\tif (startOffset === 0) {\n\t\t\t\ttravelNode = startNode.firstChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tstartNode = travelNode;\n\t\t\t\t\t\tnewRange.setStart(startNode, 0);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.firstChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (startOffset > 0) {\n\t\t\t\ttravelNode = startNode.lastChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tstartNode = travelNode;\n\t\t\t\t\t\tnewRange.setStart(startNode, startNode.textContent.length);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.lastChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\n\n\t\t}\n\n\t\tif (this.isTextContainNode(endNode)) {\n\n\t\t\t\n\n\t\t\tif (endOffset > 0) {\n\t\t\t\ttravelNode = endNode.lastChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tendNode = travelNode;\n\t\t\t\t\t\tnewRange.setEnd(endNode, endNode.textContent.length);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.lastChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (endOffset === 0) {\n\t\t\t\ttravelNode = endNode.firstChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tendNode = travelNode;\n\t\t\t\t\t\tnewRange.setEnd(endNode, 0);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.firstChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\n\n\t\t}\n\n\n\n\t\tif (isChanged) {\n\t\t\t// console.log(orgS, orgSO);\n\t\t\t// console.log(orgE, orgEO);\n\t\t\t// console.log(orgS, orgSO);\n\t\t\t// console.log(orgE, orgEO);\n\t\t\t// console.log(\"fixed selection\");\n\t\t\t// console.log(newRange.startContainer, newRange.startOffset);\n\t\t\t// console.log(newRange.endContainer, newRange.endOffset);\n\t\t\tthis.replaceRange(newRange);\n\t\t}\n\n\t\tstartNode = this.getRange().startContainer;\n\t\tstartOffset = this.getRange().startOffset;\n\t\tif (startNode.nodeType === 3 && startNode.textContent === \"\") {\n\t\t\tstartNode.parentNode.normalize();\n\t\t}\n\t\t\n\t\t\n\t}\n\n\n\t/**\n\t * Implementing return(enter) key inside blockquotes.\n\t */\n\tsplitElementNode()\n\t{\n\n\t\tvar range;\n\n\t\trange = this.getRange();\n\t\t\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar startNode = range.startContainer;\n\t\tvar startOffset = range.startOffset;\n\t\tvar endNode = range.endContainer;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar frontNode, backNode;\n\t\tvar backNodePassed = false;\n\n\t\tvar travelNode = startNode;\n\n\t\tvar tempNode, nextNode;\n\n\t\tvar orgNode;\n\t\tvar newNode;\n\n\t\t// Loop from the bottom to the top of the node.\n\t\tvar count = 0;\n\t\twhile (1) {\n\n\t\t\tif (this.isAvailableParentNode(travelNode)) {\n\t\t\t\tbreak;\n\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\n\t\t\t\tif (this.getSelectionPosition() === 1) {\n\t\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t\t\tbackNode = startNode.parentElement;\n\t\t\t\t\tstartNode = backNode.previousSibling;\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tif (startOffset === 0) {\n\t\t\t\t\t\tfrontNode = startNode.previousSibling;\n\t\t\t\t\t\tbackNode = startNode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.splitTextNode();\n\t\t\t\t\t\tfrontNode = startNode;\n\t\t\t\t\t\tbackNode = frontNode.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t} else if (this.isTextStyleNode(travelNode)) {\n\n\t\t\t\tif (frontNode === undefined) {\n\n\t\t\t\t}\n\n\t\t\t\tif (backNode === undefined) {\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\torgNode = travelNode.parentElement;\n\t\t\t\n\t\t\tnewNode = document.createElement(orgNode.nodeName);\n\n\t\t\ttempNode = orgNode.firstChild;\n\n\t\t\tif (!frontNode) {\n\t\t\t\tfrontNode = backNode.previousSibling;\n\t\t\t}\n\n\t\t\tif (!backNode) {\n\t\t\t\tbackNode = frontNode.nextSibling;\n\t\t\t}\n\n\t\t\tconsole.log('-------------------');\n\t\t\tconsole.log(frontNode, backNode, newNode);\n\n\t\t\twhile (1) {\n\t\t\t\t\n\t\t\t\tif (!tempNode) {\n\t\t\t\t\tbackNodePassed = false;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tnextNode = tempNode.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (tempNode === backNode) {\n\t\t\t\t\tbackNodePassed = true;\n\t\t\t\t}\n\n\t\t\t\tif (backNodePassed) {\n\t\t\t\t\tnewNode.appendChild(tempNode);\n\t\t\t\t}\n\n\t\t\t\ttempNode = nextNode;\n\n\t\t\t}\n\n\t\t\tif (this.isEmptyNode(orgNode)) {\n\t\t\t\torgNode.parentNode.removeChild(orgNode);\n\t\t\t\torgNode = null;\n\t\t\t}\n\n\t\t\tif (!this.isEmptyNode(newNode)) {\n\t\t\t\torgNode.parentNode.insertBefore(newNode, orgNode.nextSibling);\n\t\t\t} else {\n\t\t\t\tnewNode = null;\n\t\t\t}\n\n\t\t\tfrontNode = orgNode;\n\t\t\tbackNode = newNode;\n\n\n\t\t\t// If there is a newNode inserted,\n\t\t\t// move a range to it.\n\t\t\tif (newNode) {\n\t\t\t\trange.setStart(newNode, 0);\n\t\t\t\tthis.replaceRange(range);\n\t\t\t}\n\t\t\t\n\t\t\t\n\n\t\t\ttravelNode = travelNode.parentElement;\n\n\t\t}\n\n\t}\n\n\tmergeNodes(first, second, matchTopNode = false)\n\t{\n\t\tconsole.log(\"merge method runs\");\n\n\t\tif (!first || !second) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar front = first, back = second;\n\t\tvar tempNode;\n\t\tvar nextFront, nextBack;\n\n\t\tvar range = window.getSelection().getRangeAt(0);\n\t\tvar startNode = this.getTextNodeInElementNode(first, \"last\");\n\t\tvar startOffset;\n\t\tif (startNode) {\n\t\t\tstartOffset = startNode.textContent.length;\n\t\t} else {\n\t\t\tstartNode = this.getTextNodeInElementNode(second, \"first\");\n\t\t\tif (startNode) {\n\t\t\t\tstartOffset = 0;\n\t\t\t}\n\t\t}\n\n\t\t\n\n\t\twhile (1) {\n\n\t\t\tconsole.log(\"front: \", front, \" back: \", back);\n\n\t\t\tif (!front || !back) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (front.nodeName !== back.nodeName) {\n\t\t\t\tif (\n\t\t\t\t\tfront === first &&\n\t\t\t\t\tback === second &&\n\t\t\t\t\tmatchTopNode\n\t\t\t\t) {\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\n\t\t\tif (front.nodeType === 3) {\n\n\t\t\t\tfront.textContent += back.textContent;\n\t\t\t\tback.parentNode.removeChild(back);\n\n\t\t\t\tif (front.textContent === \"\" || back.textContent === \"\") {\n\n\t\t\t\t\tif (front.textContent === \"\") {\n\t\t\t\t\t\tfront = front.previousSibling;\n\t\t\t\t\t\tfront.parentNode.removeChild(front);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (back.textContent === \"\") {\n\t\t\t\t\t\tback = back.nextSibling;\n\t\t\t\t\t\tback.parentNode.removeChild(back);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t\n\n\t\t\t\tbreak;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.log(\"here\");\n\n\t\t\t\tnextFront = front.lastChild;\n\t\t\t\tnextBack = back.firstChild;\n\n\t\t\t\twhile (tempNode = back.firstChild) {\n\t\t\t\t\tfront.appendChild(tempNode);\n\t\t\t\t}\n\n\t\t\t\tback.parentNode.removeChild(back);\n\n\t\t\t\tfront = nextFront;\n\t\t\t\tback = nextBack;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif (startNode) {\n\t\t\tvar keepRange = document.createRange();\n\t\t\tkeepRange.setStart(startNode, startOffset);\n\t\t\tkeepRange.setEnd(startNode, startOffset);\n\t\t\tthis.replaceRange(keepRange);\n\t\t}\n\t\t\n\n\t}\n\n\t/**\n\t * Splits text nodes based on the selection and\n\t * returns start and end node.\n\t * @return {Object.<Text>}\n\t */\n\tsplitTextNode()\n\t{\n\t\tvar range = this.getRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tvar startNode = range.startContainer;\n\t\tvar startOffset = range.startOffset;\n\n\t\tvar returnNode = {\n\t\t\tstartNode: null,\n\t\t\tendNode: null\n\t\t}\n\n\t\treturnNode.startNode = startNode;\n\t\t\n\t\t// Split start of the range.\n\t\tif (\n\t\t\tstartNode.nodeType === 3 &&\n\t\t\tstartOffset > 0 &&\n\t\t\tstartOffset < startNode.textContent.length\n\t\t) {\n\t\t\t\n\t\t\treturnNode.startNode = startNode.splitText(startOffset);\n\n\t\t}\n\n\t\trange = this.getRange();\n\t\tvar endNode = range.endContainer;\n\t\tvar endOffset = range.endOffset;\n\n\t\treturnNode.endNode = endNode;\n\n\t\t// Split end of the range.\n\t\tif (\n\t\t\tstartNode !== endNode &&\n\t\t\tendNode.nodeType === 3 &&\n\t\t\tendOffset < endNode.textContent.length\n\t\t) {\n\n\t\t\tendNode.splitText(endOffset);\n\n\t\t}\n\n\t\treturn returnNode;\n\n\t}\n\n\t/**\n\t * Remove selection.\n\t */\n\tremoveSelection(collapseDirection = \"end\")\n\t{\n\t\tvar range = this.getRange();\n\t\tvar orgRange = range.cloneRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar splitResult = this.splitTextNode();\n\n\t\tvar startNode = splitResult.startNode;\n\t\tvar endNode = splitResult.endNode;\n\t\t\n\t\tvar deletionDone = false;\n\t\tvar selectionNode = this.getNodeInSelection();\n\t\tvar nextParentNode = this.getNextAvailableNode(selectionNode);\n\n\t\t// range.collapse(false);\n\n\t\trange.setStart(range.endContainer, range.endOffset);\n\t\tthis.replaceRange(range);\n\t\t\n\n\t\tvar currentParentNode = selectionNode;\n\t\tvar travelNode = startNode;\n\t\tvar nextNode;\n\t\tvar parentNode;\n\n\t\twhile (1) {\n\t\t\tif (\n\t\t\t\t!currentParentNode.contains(startNode) &&\n\t\t\t\t!currentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\tconsole.log(\"nothing contains\");\n\t\t\t\tconsole.log(currentParentNode.textContent);\n\t\t\t\tcurrentParentNode.parentNode.removeChild(currentParentNode);\n\t\t\t} else if (\n\t\t\t\tcurrentParentNode.contains(startNode) &&\n\t\t\t\t!currentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\ttravelNode = startNode;\n\t\t\t\tconsole.log(\"only contains startnode\");\n\t\t\t\tconsole.log(currentParentNode.textContent);\n\t\t\t\tvar metCurrentNode = false;\n\n\t\t\t\tvar tempRange = document.createRange();\n\t\t\t\ttempRange.setStart(startNode, 0);\n\t\t\t\ttempRange.setEndAfter(currentParentNode.lastChild);\n\n\t\t\t\ttempRange.deleteContents();\n\n\t\t\t\tif (this.isTextEmptyNode(currentParentNode)) {\n\t\t\t\t\tcurrentParentNode.innerHTML = \"\";\n\t\t\t\t\tcurrentParentNode.appendChild(document.createElement(\"br\"));\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t!currentParentNode.contains(startNode) &&\n\t\t\t\tcurrentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\ttravelNode = endNode;\n\t\t\t\tconsole.log(\"only contains endnode\");\n\t\t\t\tconsole.log(currentParentNode.textContent);\n\n\n\t\t\t\tvar tempRange = document.createRange();\n\t\t\t\ttempRange.setStartBefore(currentParentNode.firstChild);\n\t\t\t\ttempRange.setEnd(endNode, orgRange.endOffset);\n\n\t\t\t\ttempRange.deleteContents();\n\n\t\t\t\tif (this.isTextEmptyNode(currentParentNode)) {\n\t\t\t\t\tcurrentParentNode.innerHTML = \"\";\n\t\t\t\t\tcurrentParentNode.appendChild(document.createElement(\"br\"));\n\t\t\t\t}\n\t\t\t\tif (collapseDirection === \"start\") {\n\t\t\t\t\tthis.backspace(document.createEvent(\"KeyboardEvent\")); \n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t} else if (\n\t\t\t\tcurrentParentNode.contains(startNode) &&\n\t\t\t\tcurrentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\ttravelNode = startNode;\n\t\t\t\torgRange.deleteContents();\n\t\t\t\tif (this.isTextEmptyNode(currentParentNode)) {\n\t\t\t\t\tcurrentParentNode.innerHTML = \"\";\n\t\t\t\t\tcurrentParentNode.appendChild(document.createElement(\"br\"));\n\t\t\t\t}\n\n\t\t\t\tconsole.log(startNode);\n\t\t\t\tconsole.log(endNode);\n\n\t\t\t\tif (collapseDirection === \"end\") {\n\t\t\t\t\tthis.enter(document.createEvent(\"KeyboardEvent\")); \n\t\t\t\t}\n\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcurrentParentNode = nextParentNode;\n\t\t\tnextParentNode = this.getNextAvailableNode(nextParentNode);\n\t\t}\n\n\t\t// this.fixSelection();\n\n\n\n\t}\n\n\t/**\n\t * Return true if the selection is empty.\n\t */\n\tisEmpty()\n\t{\n\t\tif (document.getSelection().isCollapsed) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\n\n\n\t/**\n\t * If there isn't any of child nodes including \"\" text nodes, returns true.\n\t * And truly clear the node to real empty.\n\t * @param {HTMLElement} node \n\t */\n\tisEmptyNode(node)\n\t{\n\n\t\tif (node.nodeType === 3) {\n\t\t\treturn false;\n\t\t}\n\t\tvar travelNode = node.firstChild;\n\t\tvar nextNode = travelNode;\n\n\t\twhile (1) {\n\n\t\t\tif (!travelNode) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tnextNode = travelNode.nextSibling;\n\n\t\t\tif (travelNode.nodeType === 3 && travelNode.textContent === \"\") {\n\t\t\t\tnode.removeChild(travelNode);\n\t\t\t} else if (travelNode.nodeName !== \"BR\") {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\ttravelNode = nextNode;\n\n\t\t}\n\t}\n\n\tisTextEmptyNode(node)\n\t{\n\t\tif (node.nodeType === 3) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tnode.textContent === \"\" &&\n\t\t\t!(node.querySelector(\"br\"))\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisTextContainNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isParagraph(node) ||\n\t\t\tthis.isHeading(node)   ||\n\t\t\tthis.isList(node)      ||\n\t\t\tthis.isListItem(node)  ||\n\t\t\tthis.isBlockquote(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisTextStyleNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isBold(node) ||\n\t\t\tthis.isItalics(node)   ||\n\t\t\tthis.isStrike(node)      ||\n\t\t\tthis.isUnderline(node)  ||\n\t\t\tthis.isLink(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisBold(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'B' ||\n\t\t\tnode.nodeName === 'STRONG'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisItalics(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'I' ||\n\t\t\tnode.nodeName === 'EM'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisStrike(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'STRIKE') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisUnderline(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'U') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisLink(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'LINK') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Determine if the given node is a paragraph node which Povium understands.\n\t * @param {Node} node\n\t */\n\tisParagraph(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'P') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisHeading(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'H1' ||\n\t\t\tnode.nodeName === 'H2' ||\n\t\t\tnode.nodeName === 'H3' ||\n\t\t\tnode.nodeName === 'H4' ||\n\t\t\tnode.nodeName === 'H5' ||\n\t\t\tnode.nodeName === 'H6'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisList(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'OL' ||\n\t\t\tnode.nodeName === 'UL'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisListItem(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'LI') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisBlockquote(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'BLOCKQUOTE') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Returns true if the node is an available image block.\n\t * @param {HTMLElement} node \n\t */\n\tisImageBlock(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.classList && node.classList.contains('image-block')) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisAvailableParentNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isParagraph(node) ||\n\t\t\tthis.isHeading(node) ||\n\t\t\tthis.isList(node) ||\n\t\t\tthis.isBlockquote(node) ||\n\t\t\tthis.isImageBlock(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisAvailableChildNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isListItem(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\n\t/**\n\t * Get the first or last text node inside the HTMLElement\n\t * @param {HTMLElement} node\n\t * @param {String} firstOrLast\n\t * \"first\" | \"last\" \n\t */\n\tgetTextNodeInElementNode(node, firstOrLast)\n\t{\n\t\tvar travelNode = node;\n\t\tvar returnNode = null;\n\t\tif (!node) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (firstOrLast === \"first\") {\n\t\t\twhile (1) {\n\t\t\t\tif (travelNode === null) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\treturnNode = travelNode;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.firstChild;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (firstOrLast === \"last\") {\n\t\t\twhile (1) {\n\t\t\t\tif (travelNode === null) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\treturnNode = travelNode;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.lastChild;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.error(\"Second parameter must be 'first' or 'last'.\");\n\t\t}\n\n\t\treturn returnNode;\n\t\t\n\t}\n\n\tgetSelectionPosition(customRange = null)\n\t{\n\n\t\tvar orgRange;\n\n\t\tif (customRange) {\n\t\t\torgRange = customRange;\n\t\t} else {\n\t\t\torgRange = this.getRange();\n\t\t}\n\n\t\tif (!orgRange) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar startNode   = orgRange.startContainer;\n\t\tvar startOffset = orgRange.startOffset;\n\t\tvar endNode     = orgRange.endContainer;\n\t\tvar endOffset   = orgRange.endOffset;\n\n\n\t\tvar travelNode;\n\t\tvar isStart = false;\n\t\tvar isEnd   = false;\n\n\n\t\ttravelNode = startNode.previousSibling;\n\n\t\twhile (1) {\n\t\t\tif (!travelNode && startOffset === 0) {\n\t\t\t\tisStart = true;\n\t\t\t\tbreak;\n\t\t\t} else if (!travelNode) {\n\t\t\t\tbreak;\n\t\t\t} else if (travelNode.textContent === \"\") {\n\t\t\t\ttravelNode = travelNode.previousSibling;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\n\n\t\ttravelNode = endNode.nextSibling;\n\n\t\twhile (1) {\n\t\t\tif (!travelNode && endOffset === endNode.textContent.length) {\n\t\t\t\tisEnd = true;\n\t\t\t\tbreak;\n\t\t\t} else if (!travelNode) {\n\t\t\t\tbreak;\n\t\t\t} else if (travelNode.textContent === \"\") {\n\t\t\t\ttravelNode = travelNode.nextSibling;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\n\t\tif (startNode === endNode && this.isEmptyNode(startNode)) {\n\t\t\tisEnd = true;\n\t\t}\n\n\t\tif (isStart) {\n\t\t\treturn 1;\n\t\t} else if (isEnd) {\n\t\t\treturn 3;\n\t\t} else {\n\t\t\treturn 2;\n\t\t}\n\n\t}\n\n\tgetSelectionPositionInParagraph(customRange = null)\n\t{\n\t\tvar orgRange;\n\n\t\tif (customRange) {\n\t\t\torgRange = customRange;\n\t\t} else {\n\t\t\torgRange = this.getRange();\n\t\t}\n\n\t\tif (!orgRange) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar startNode   = orgRange.startContainer;\n\t\tvar startOffset = orgRange.startOffset;\n\t\tvar endNode     = orgRange.endContainer;\n\t\tvar endOffset   = orgRange.endOffset;\n\n\n\t\tvar travelNode, parentNode;\n\t\tvar isStart = false;\n\t\tvar isEnd   = false;\n\n\n\t\tparentNode = startNode.parentElement;\n\t\ttravelNode = startNode;\n\t\t\n\t\tif (startOffset === 0) {\n\t\t\twhile (1) {\n\t\t\t\tif (\n\t\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t\t) {\n\t\t\t\t\tisStart = true;\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.previousSibling) {\n\t\t\t\t\tif (travelNode.previousSibling.textContent === \"\" || travelNode.previousSibling.nodeName === \"BR\") {\n\t\t\t\t\t\ttravelNode = travelNode.previousSibling;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisStart = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\n\n\t\tparentNode = endNode.parentElement;\n\t\ttravelNode = endNode;\n\t\tif (endOffset === endNode.textContent.length) {\n\t\t\twhile (1) {\n\t\t\t\tif (\n\t\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t\t) {\n\t\t\t\t\tisEnd = true;\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.nextSibling) {\n\t\t\t\t\tif (travelNode.nextSibling.textContent === \"\" || travelNode.nextSibling.nodeName === \"BR\") {\n\t\t\t\t\t\ttravelNode = travelNode.nextSibling;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisEnd = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (startNode === endNode && this.isEmptyNode(startNode)) {\n\t\t\tisStart = false;\n\t\t\tisEnd = true;\n\t\t}\n\n\t\tif (isStart) {\n\t\t\treturn 1;\n\t\t} else if (isEnd) {\n\t\t\treturn 3;\n\t\t} else {\n\t\t\treturn 2;\n\t\t}\n\t}\n\n\n\n\t// Getters\n\n\t\n\t/**\n\t * @return {Range}\n\t */\n\tgetRange()\n\t{\n\t\tif (document.getSelection().rangeCount > 0) {\n\t\t\treturn document.getSelection().getRangeAt(0);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Returns an array of all available nodes within the selection.\n\t * @return {Array.<HTMLElement>}\n\t */\n\tgetAllNodesInSelection()\n\t{\n\n\t\tlet travelNode = this.getRange() ? this.getRange().startContainer : null;\n\t\tlet nodes = [];\n\n\t\twhile (1) {\n\n\n\t\t\tif (!travelNode) {\n\t\t\t\tbreak;\n\t\t\t} else if (this.isAvailableParentNode(travelNode)) {\n\t\t\t\tnodes.push(travelNode);\n\t\t\t\tif (travelNode.contains(this.getRange().endContainer)) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.nextElementSibling;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t}\n\n\t\t}\n\n\t\treturn nodes;\n\n\t}\n\n\tgetPreviousAvailableNode(node)\n\t{\n\t\tvar previousNode = node;\n\t\tvar travelNode = node.previousSibling;\n\t\tvar returnNode = null;\n\t\twhile (1) {\n\t\t\tif (travelNode === null) {\n\t\t\t\tif (this.isAvailableChildNode(previousNode)) {\n\t\t\t\t\ttravelNode = previousNode.parentNode.previousSibling;\n\t\t\t\t\tpreviousNode = travelNode;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t) {\n\t\t\t\t// Find the available node\n\t\t\t\tif (this.isList(travelNode)) {\n\t\t\t\t\tvar itemNodes = travelNode.querySelectorAll(\"LI\");\n\t\t\t\t\ttravelNode = itemNodes[itemNodes.length - 1];\n\t\t\t\t}\n\t\t\t\treturnNode = travelNode;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.previousSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn returnNode;\n\t}\n\n\tgetNextAvailableNode(node)\n\t{\n\t\tvar previousNode = node;\n\t\tvar travelNode = node.nextSibling;\n\t\tvar returnNode = null;\n\t\twhile (1) {\n\t\t\tif (travelNode === null) {\n\t\t\t\tif (this.isAvailableChildNode(previousNode)) {\n\t\t\t\t\ttravelNode = previousNode.parentNode.nextSibling;\n\t\t\t\t\tpreviousNode = travelNode;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t) {\n\t\t\t\t// Find the available node\n\t\t\t\tif (this.isList(travelNode)) {\n\t\t\t\t\ttravelNode = travelNode.querySelectorAll(\"LI\")[0];\n\t\t\t\t}\n\t\t\t\treturnNode = travelNode;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.nextSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn returnNode;\n\t}\n\n\tgetNodeInSelection()\n\t{\n\n\t\tvar range = this.getRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tvar travelNode = this.getRange().startContainer;\n\t\tif (travelNode === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\twhile (1) {\n\t\t\tif (travelNode === null) {\n\t\t\t\treturn null;\n\t\t\t} else if (\n\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t) {\n\t\t\t\treturn travelNode;\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.parentNode;\n\t\t\t}\n\t\t}\n\n\t}\n\n}","Node.prototype.merge = function (node) {\n\n    \n}"],"sourceRoot":""}