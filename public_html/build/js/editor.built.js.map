{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./resources/assets/js/editor/main.js","webpack:///./resources/assets/js/editor/PostEditor.js","webpack:///./resources/assets/js/editor/DOMManager.js","webpack:///./resources/assets/js/editor/SelectionManager.js","webpack:///./resources/assets/js/editor/PoviumNode.js"],"names":["editor","PostEditor","document","querySelector","editorDOM","self","domManager","DOMManager","selManager","SelectionManager","mouseDownStart","execCommand","addEventListener","onSelectionChanged","window","isBackspaceKeyPressed","e","onKeyDown","onKeyUp","onKeyPress","onPaste","paragraph","heading","heading1","heading2","heading3","boldButton","bold","italicButton","italic","underlineButton","underline","strikeButton","strike","alignLeft","align","alignCenter","alignRight","initEditor","clipboardData","pastedData","stopPropagation","preventDefault","getData","paste","currentNode","getNodeInSelection","textContent","removeChild","sel","getSelection","rangeCount","contains","getRangeAt","startContainer","console","warn","keyCode","which","backspace","log","delete","enter","fixSelection","range","getRange","collapsed","classList","add","style","left","getBoundingClientRect","width","top","height","remove","emptyNode","createElement","innerHTML","opacity","appendChild","createRange","setStart","firstChild","setEnd","replaceRange","removeAllRanges","contentInside","childNodesCount","getAllNodesInSelection","length","pHolder","toolbar","orderedList","unorderedList","link","blockquote","tagName","elm","br","firstNode","secondNode","front","back","nodeName","nodeType","direction","chunks","node","i","isParagraph","isHeading","textAlign","type","orgRange","startNode","startOffset","endNode","endContainer","endOffset","changedNode","changeNodeName","keepRange","undefined","error","listElm","placedListElm","placedListElmIndex","unlockList","recordList","itemElm","parentNode","isList","includes","push","childElementCount","replaceChild","itemNode","nextNode","part1","part2","part3","part1ListElm","part3ListElm","part1ListElmInserted","part3ListElmInserted","part3Will","setStartAfter","nextElementSibling","insertNode","pElm","url","isAllBlockquote","removeSelection","isAvailableEmptyNode","isAvailableChildNode","isAvailableParentNode","getPreviousAvailableNode","previousNode","lastChild","querySelectorAll","isListItem","list","getSelectionPositionInParagraph","mergeNodes","getNextAvailableNode","setStartBefore","selectionNode","selPosType","splitElementNode","generateEmptyNode","insertBefore","newNodeName","nextSibling","isBlockquote","isEmptyNode","collapse","splitted","split","forEach","index","addedNode","line","createTextNode","replace","addRange","targetNode","keepStyle","newNode","orgS","orgSO","orgE","orgEO","target","newRange","isChanged","firstElementChild","travelNode","isTextContainNode","normalize","frontNode","backNode","backNodePassed","tempNode","orgNode","count","getSelectionPosition","parentElement","previousSibling","splitTextNode","isTextStyleNode","first","second","matchTopNode","nextFront","nextBack","getTextNodeInElementNode","returnNode","splitText","collapseDirection","cloneRange","splitResult","deletionDone","nextParentNode","currentParentNode","metCurrentNode","tempRange","setEndAfter","deleteContents","isTextEmptyNode","createEvent","isCollapsed","isBold","isItalics","isStrike","isUnderline","isLink","isImageBlock","firstOrLast","customRange","isStart","isEnd","nodes","itemNodes","Node","prototype","merge"],"mappings":"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","file":"editor.built.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n","import PostEditor from \"./PostEditor\";\nimport \"./PoviumNode\";\n\nconst editor = new PostEditor(document.querySelector('#post-editor'));\n\n// var a = document.createElement('h1').nodeName;\n// console.log(a);\n\n// document.querySelector('#log-range').addEventListener('click', function () {\n\n// \tvar sel = window.getSelection();\n\n// \tif (sel.rangeCount === 0) {\n// \t\treturn;\n// \t}\n\n// \tvar range = sel.getRangeAt(0);\n\n// \tconsole.log(range.startContainer);\n// \tconsole.log(range.startOffset);\n// \tconsole.log(range.endContainer);\n// \tconsole.log(range.endOffset);\n\n// });\n\n// document.querySelector('#nodes-in-selection').addEventListener('click', function () {\n\n// \tconsole.log(editor.selManager.getAllNodesInSelection());\n\n// });\n\n// document.querySelector('#separate').addEventListener('click', function () {\n\n// \teditor.selManager.splitElementNode2();\n\n// });\n\n// document.querySelector('#split-text').addEventListener('click', function () {\n\n// \teditor.selManager.splitTextNode();\n\n// });\n\n// document.querySelector('#get-sel-pos').addEventListener('click', function () {\n\n// \tconsole.log(editor.selManager.getSelectionPosition());\n\n// });\n\n// document.querySelector('#get-sel-pos-par').addEventListener('click', function () {\n\n// \tconsole.log(editor.selManager.getSelectionPositionInParagraph());\n\n// });\n\n\n// var dom = document.createElement(\"ol\");\n// dom.innerHTML = \"<li></li>\";\n// console.log(editor.selManager.isEmptyNode(dom));\n// console.log(editor.selManager.isTextEmptyNode(dom));","import DOMManager from \"./DOMManager\";\nimport SelectionManager from \"./SelectionManager\";\n\nexport default class PostEditor {\n\n\t/**\n\t * Creates a new PostEditor object.\n\t * @param {HTMLElement} editorDOM\n\t */\n\tconstructor (editorDOM) {\n\n\t\tlet self = this;\n\n\t\tthis.domManager = new DOMManager(editorDOM);\n\t\tthis.selManager = new SelectionManager(this.domManager);\n\n\t\tthis.mouseDownStart = false;\n\n\t\tdocument.execCommand(\"defaultParagraphSeparator\", false, \"p\");\n\n\t\t// Event Listeners\n\n\t\tthis.domManager.editor.addEventListener('click', () => { this.onSelectionChanged(); });\n\n\t\tthis.domManager.editor.addEventListener('mousedown', () => {\n\t\t\tthis.mouseDownStart = true;\n\t\t});\n\t\twindow.addEventListener('mouseup', () => {\n\t\t\tif (this.mouseDownStart) {\n\t\t\t\tthis.mouseDownStart = false;\n\t\t\t\t// this.onSelectionChanged();\n\t\t\t}\n\t\t\t\n\t\t});\n\n\n\t\tthis.isBackspaceKeyPressed = false;\n\n\t\twindow.addEventListener('keydown', (e) => {\n\t\t\tthis.onKeyDown(e);\n\t\t\tthis.onSelectionChanged();\n\t\t});\n\t\tthis.domManager.editor.addEventListener('keyup', (e) => {\n\t\t\tthis.onKeyUp(e);\n\t\t\t\n\t\t\tthis.onSelectionChanged();\n\t\t});\n\t\tthis.domManager.editor.addEventListener('keypress', (e) => {\n\t\t\tthis.onKeyPress(e);\n\t\t});\n\n\t\tthis.domManager.editor.addEventListener('paste', (e) => { this.onPaste(e); });\n\n\t\t// Toolbar button events\n\t\tthis.domManager.paragraph.addEventListener('click', (e) => { this.selManager.heading('P'); });\n\t\tthis.domManager.heading1.addEventListener('click', (e) => { this.selManager.heading('H1'); });\n\t\tthis.domManager.heading2.addEventListener('click', (e) => { this.selManager.heading('H2'); });\n\t\tthis.domManager.heading3.addEventListener('click', (e) => { this.selManager.heading('H3'); });\n\n\t\tthis.domManager.boldButton.addEventListener('click', (e) => { this.selManager.bold(); });\n\t\tthis.domManager.italicButton.addEventListener('click', (e) => { this.selManager.italic(); });\n\t\tthis.domManager.underlineButton.addEventListener('click', (e) => { this.selManager.underline(); });\n\t\tthis.domManager.strikeButton.addEventListener('click', (e) => { this.selManager.strike(); });\n\n\t\tthis.domManager.alignLeft.addEventListener('click', (e) => { this.selManager.align('left'); });\n\t\tthis.domManager.alignCenter.addEventListener('click', (e) => { this.selManager.align('center'); });\n\t\tthis.domManager.alignRight.addEventListener('click', (e) => { this.selManager.align('right'); });\n\n\t\t// this.domManager.orderedList.addEventListener('click', (e) => { this.selManager.list('OL'); });\n\t\t// this.domManager.unorderedList.addEventListener('click', (e) => { this.selManager.list('UL'); });\n\t\t// this.domManager.link.addEventListener('click', (e) => { this.selManager.link(\"naver.com\"); });\n\t\t// this.domManager.blockquote.addEventListener('click', (e) => { this.selManager.blockquote(); });\n\n\t\tthis.initEditor();\n\n\t}\n\n\t// Events\n\n\t\n\n\t/**\n\t *\n\t * @param {KeyboardEvent} e\n\t */\n\tonPaste (e) {\n\n\t\tlet clipboardData, pastedData;\n\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\n\t\t// Get data from clipboard and conver\n\t\tclipboardData = e.clipboardData || window.clipboardData;\n\t\tpastedData = clipboardData.getData('Text');\n\n\t\tthis.selManager.paste(pastedData);\n\n\t}\n\n\n\tonKeyPress (e) {\n\n\t}\n\n\t/**\n\t * Fires when press keyboard inside the editor.\n\t * @param {KeyboardEvent} e \n\t */\n\tonKeyUp (e) {\n\t\tvar currentNode = this.selManager.getNodeInSelection();\n\t\tif (currentNode && currentNode.textContent !== \"\" && currentNode.querySelector(\"br\")) {\n\t\t\tcurrentNode.removeChild(currentNode.querySelector(\"br\"));\n\t\t}\n\t}\n\n\tonKeyDown (e) {\n\n\t\tvar sel = window.getSelection();\n\t\tif (sel.rangeCount > 0) {\n\t\t\tif (!this.domManager.editor.contains(sel.getRangeAt(0).startContainer)) {\n\t\t\t\tconsole.warn(\"The given range is not in the editor. Editor's features will work only inside the editor.\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tvar keyCode = e.which;\n\n\t\t// Delete key\n\t\tif (keyCode === 8) {\n\n\t\t\tthis.selManager.backspace(e);\n\n\t\t} else if (keyCode === 46) {\n\t\t\tconsole.log(\"delete\");\n\t\t\tthis.selManager.delete(e);\n\t\t} else if (keyCode === 13) {\n\n\t\t\tthis.selManager.enter(e);\n\t\t\t\n\t\t}\n\t\t\n\t}\n\n\n\tonSelectionChanged () {\n\n\t\t// console.log('selection has been changed');\n\n\t\t\n\t\tthis.selManager.fixSelection();\n\t\tvar range = this.selManager.getRange();\n\t\tif (range && !range.collapsed) {\n\t\t\tdocument.querySelector(\"#poptool\").classList.add(\"active\");\n\t\t\tdocument.querySelector(\"#poptool\").style.left = range.getBoundingClientRect().left - document.querySelector(\"#post-editor\").getBoundingClientRect().left + range.getBoundingClientRect().width / 2 - document.querySelector(\"#poptool\").getBoundingClientRect().width / 2  + \"px\";\n\t\t\tconsole.log(document.querySelector(\"#post-editor\").getBoundingClientRect().top);\n\t\t\tdocument.querySelector(\"#poptool\").style.top = range.getBoundingClientRect().top - document.querySelector(\"#post-editor\").getBoundingClientRect().top - document.querySelector(\"#poptool\").getBoundingClientRect().height - 5 + \"px\";\n\t\t} else {\n\t\t\tdocument.querySelector(\"#poptool\").classList.remove(\"active\");\n\t\t}\n\n\t}\n\n\n\t// Methods\n\n\t/**\n\t * Initialize editor.\n\t */\n\tinitEditor () {\n\n\t\t// Fix flickering when add text style first time\n\t\t// in Chrome browser.\n\t\tvar emptyNode = document.createElement('p');\n\t\temptyNode.innerHTML = 'a';\n\t\temptyNode.style.opacity = '0';\n\t\tthis.domManager.editor.appendChild(emptyNode);\n\t\tvar range = document.createRange();\n\t\trange.setStart(emptyNode.firstChild, 0);\n\t\trange.setEnd(emptyNode.firstChild, 1);\n\t\tthis.selManager.replaceRange(range);\n\t\tdocument.execCommand('bold', false);\n\t\tthis.domManager.editor.removeChild(emptyNode);\n\t\tdocument.getSelection().removeAllRanges();\n\n\t\t// if (this.isEmpty()) {\n\t\t// \tthis.domManager.editor.innerHTML = \"\";\n\t\t// \tvar emptyP = this.domManager.generateEmptyParagraph('p');\n\t\t// \tthis.domManager.editor.appendChild(emptyP);\n\n\t\t// \tvar range = document.createRange();\n\t\t// \trange.setStartBefore(emptyP);\n\t\t// \trange.collapse(true);\n\n\t\t// \tthis.selManager.sel.removeAllRanges();\n\t\t// \tthis.selManager.sel.addRange(range);\n\t\t// }\n\t\t\n\t}\n\n\tclearEditor () {\n\n\t\tthis.domManager.editor.innerHTML = \"\";\n\n\t}\n\t\n\n\t/**\n\t * Return true if the editor is empty.\n\t */\n\tisEmpty () {\n\t\tlet contentInside = this.domManager.editor.textContent;\n\t\tlet childNodesCount = this.selManager.getAllNodesInSelection().length;\n\t\tif (contentInside === \"\" && childNodesCount < 1) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n}\n","export default class DOMManager {\n\n\t/**\n\t * Manages html DOM.\n\t * @param {HTMLElement} editorDOM\n\t */\n\tconstructor (editorDOM) {\n\n\t\tthis.pHolder = document.createElement('p');\n\t\tthis.pHolder.innerHTML = '<br>';\n\n\t\t// Editor body\n\t\tthis.editor = editorDOM.querySelector('#editor-body');\n\n\t\t// Toolbar\n\t\tthis.toolbar = editorDOM.querySelector('#editor-toolbar');\n\n\t\t// Toolbar buttons\n\t\tthis.paragraph = editorDOM.querySelector('#p');\n\t\tthis.heading1 = editorDOM.querySelector('#h1');\n\t\tthis.heading2 = editorDOM.querySelector('#h2');\n\t\tthis.heading3 = editorDOM.querySelector('#h3');\n\n\t\tthis.boldButton = editorDOM.querySelector('#bold');\n\t\tthis.italicButton = editorDOM.querySelector('#italic');\n\t\tthis.underlineButton = editorDOM.querySelector('#underline');\n\t\tthis.strikeButton = editorDOM.querySelector('#strike');\n\n\t\tthis.alignLeft = editorDOM.querySelector('#align-left');\n\t\tthis.alignCenter = editorDOM.querySelector('#align-center');\n\t\tthis.alignRight = editorDOM.querySelector('#align-right');\n\n\t\tthis.orderedList = editorDOM.querySelector('#ol');\n\t\tthis.unorderedList = editorDOM.querySelector('#ul');\n\n\t\tthis.link = editorDOM.querySelector('#link');\n\t\tthis.blockquote = editorDOM.querySelector('#blockquote');\n\n\t}\n\n\t/**\n\t * \n\t * @param  {String} tagName\n\t * @return {HTMLElement}\n\t */\n\tgenerateEmptyNode (tagName) {\n\t\tvar elm = document.createElement(tagName);\n\t\tvar br = document.createElement('br');\n\t\telm.appendChild(br);\n\t\treturn elm;\n\t}\n\n\t/**\n\t * Merge two nodes into one node.\n\t * @param {Node} firstNode \n\t * @param {Node} secondNode \n\t */\n\tmergeNodes (firstNode, secondNode) {\n\t\t\n\t\tif (firstNode === null || secondNode === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar front = firstNode, back = secondNode;\n\n\t\twhile (1) {\n\n\t\t\tif (front.nodeName !== back.nodeName) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (front.nodeType === 3) {\n\n\t\t\t\t\n\n\t\t\t} else {\n\n\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}","export default class SelectionManager\n{\n\n\t/**\n\t * \n\t * @param {DOMManager} domManager\n\t */\n\tconstructor(domManager)\n\t{\n\n\t\tthis.domManager = domManager;\n\n\t}\n\n\t// Events\n\n\n\n\t// Methods\n\n\t/**\n\t * Align the selected paragraph.\n\t * @param {String} direction\n\t * Left, Center, Right\n\t */\n\talign(direction)\n\t{\n\n\t\t// document.execCommand('styleWithCSS', true);\n\t\t// document.execCommand(direction, false);\n\n\t\tvar chunks = this.getAllNodesInSelection();\n\t\tvar node;\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\tif (!this.isParagraph(chunks[i]) && !this.isHeading(chunks[i])) {\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tchunks[i].style.textAlign = direction;\n\n\t\t}\n\t\t\n\t}\n\n\n\t/**\n\t * Make the selection bold.\n\t */\n\tbold()\n\t{\n\t\tdocument.execCommand('bold', false);\n\t}\n\n\t/**\n\t * Make the selection italics.\n\t */\n\titalic()\n\t{\n\t\tdocument.execCommand('italic', false);\n\t}\n\n\tunderline()\n\t{\n\t\tdocument.execCommand('underline', false);\n\t}\n\n\tstrike()\n\t{\n\t\tdocument.execCommand('strikeThrough', false);\n\t}\n\n\t/**\n\t * \n\t * @param {string} type \n\t */\n\theading(type)\n\t{\n\n\t\t// # \n\t\t//         \n\t\t// heading   range  . range document  .\n\t\t// ->   heading  .\n\t\t\n\t\tlet orgRange = this.getRange();\n\t\tif (!orgRange) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet startNode = orgRange.startContainer;\n\t\tlet startOffset = orgRange.startOffset;\n\t\tlet endNode = orgRange.endContainer;\n\t\tlet endOffset = orgRange.endOffset;\n\t\tlet chunks = this.getAllNodesInSelection();\n\n\t\t\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\tif (chunks[i].nodeName === type) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// if (chunks[i].textContent === \"\") {\n\t\t\t// \tcontinue;\n\t\t\t// }\n\n\t\t\tif (\n\t\t\t\t!this.isParagraph(chunks[i]) &&\n\t\t\t\t!this.isHeading(chunks[i])\n\t\t\t) {\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar changedNode = this.changeNodeName(chunks[i], type);\n\t\t\tif (chunks[i] === startNode) {\n\t\t\t\tstartNode = changedNode;\n\t\t\t}\n\t\t\tif (chunks[i] === endNode) {\n\t\t\t\tendNode = changedNode;\n\t\t\t}\n\n\t\t}\n\n\t\t\n\t\tvar keepRange = document.createRange();\n\t\tkeepRange.setStart(startNode, startOffset);\n\t\tkeepRange.setEnd(endNode, endOffset);\n\t\tthis.replaceRange(keepRange);\n\n\t}\n\n\t/**\n\t * \n\t * @param {string} type \n\t */\n\tlist(type)\n\t{\n\n\t\t// If one or more lists are\n\t\t// included in the selection,\n\t\t// add other chunks to the existing list.\n\n\t\t// If all selection is already a list\n\t\t// restore them to 'P' node.\n\n\t\tlet orgRange = this.getRange();\n\t\tif (!orgRange) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (type === undefined) {\n\t\t\tconsole.error(\"List type undefined.\");\n\t\t}\n\n\t\tlet startNode = orgRange.startContainer;\n\t\tlet startOffset = orgRange.startOffset;\n\t\tlet endNode = orgRange.endContainer;\n\t\tlet endOffset = orgRange.endOffset;\n\n\t\tlet chunks = this.getAllNodesInSelection();\n\t\tlet listElm = document.createElement(type);\n\t\tvar placedListElm = false;\n\t\tvar placedListElmIndex;\n\t\tvar node;\n\n\t\tvar unlockList = true;\n\t\tvar recordList = [];\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\t// if (chunks[i].textContent === \"\") {\n\t\t\t// \tcontinue;\n\t\t\t// }\n\n\t\t\tif (\n\t\t\t\tthis.isParagraph(chunks[i]) ||\n\t\t\t\tthis.isHeading(chunks[i])\n\t\t\t) {\n\n\t\t\t\tvar itemElm = document.createElement('LI');\n\n\t\t\t\twhile (node = chunks[i].firstChild) {\n\n\t\t\t\t\titemElm.appendChild(node);\n\n\t\t\t\t}\n\n\t\t\t\tif (chunks[i] === startNode) {\n\t\t\t\t\tstartNode = itemElm;\n\t\t\t\t}\n\t\n\t\t\t\tif (chunks[i] === endNode) {\n\t\t\t\t\tendNode = itemElm;\n\t\t\t\t}\n\n\t\t\t\tlistElm.appendChild(itemElm);\n\n\t\t\t\tif (!placedListElm) {\n\t\t\t\t\tplacedListElmIndex = i;\n\t\t\t\t\tplacedListElm = true;\n\t\t\t\t} else {\n\t\t\t\t\tchunks[i].parentNode.removeChild(chunks[i]);\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t\tunlockList = false;\n\n\t\t\t} else if (this.isList(chunks[i])) {\n\n\t\t\t\t// If the node is already a list\n\t\t\t\t// move items inside to the new list element.\n\n\t\t\t\tif (!recordList.includes(chunks[i])) {\n\t\t\t\t\trecordList.push(chunks[i]);\n\t\t\t\t}\n\n\t\t\t\tif (recordList.length > 1) {\n\t\t\t\t\tunlockList = false;\n\t\t\t\t}\n\n\t\t\t\twhile (node = chunks[i].firstChild) {\n\n\t\t\t\t\tlistElm.appendChild(node);\n\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t\tif (!placedListElm) {\n\t\t\t\t\tplacedListElmIndex = i;\n\t\t\t\t\tplacedListElm = true;\n\t\t\t\t} else {\n\t\t\t\t\tchunks[i].parentNode.removeChild(chunks[i]);\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif (listElm.childElementCount < 1) {\n\t\t\treturn;\n\t\t}\n\n\t\t// this.getRange().insertNode(listElm);\n\t\tchunks[0].parentNode.replaceChild(listElm, chunks[placedListElmIndex]);\n\n\t\tif (unlockList) {\n\n\t\t\tvar range = document.createRange();\n\t\t\tvar itemNode, nextNode;\n\t\t\tvar part1 = true, part2 = false, part3 = false;\n\t\t\tvar part1ListElm = document.createElement(type), part3ListElm = document.createElement(type);\n\t\t\tvar part1ListElmInserted = false, part3ListElmInserted = false;\n\t\t\tvar part3Will = false;\n\n\t\t\trange.setStartAfter(listElm);\n\t\t\tthis.replaceRange(range);\n\n\t\t\titemNode = listElm.firstChild;\n\t\t\tnextNode = itemNode;\n\n\t\t\twhile (itemNode) {\n\n\t\t\t\tnextNode = itemNode.nextElementSibling;\n\n\t\t\t\tif (itemNode.nodeName !== \"LI\") {\n\t\t\t\t\titemNode = itemNode.nextElementSibling;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (itemNode.contains(startNode)) {\n\t\t\t\t\tpart1 = false;\n\t\t\t\t\tpart2 = true;\n\t\t\t\t\tpart3 = false;\n\t\t\t\t}\n\n\t\t\t\tif (itemNode.contains(endNode)) {\n\t\t\t\t\tpart3Will = true;\n\t\t\t\t}\n\n\n\n\n\n\t\t\t\tif (part1) {\n\n\t\t\t\t\tpart1ListElm.appendChild(itemNode);\n\n\t\t\t\t\tif (!part1ListElmInserted) {\n\t\t\t\t\t\trange.insertNode(part1ListElm);\n\t\t\t\t\t\trange.setStartAfter(part1ListElm);\n\t\t\t\t\t\tpart1ListElmInserted = true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if (part2) {\n\n\t\t\t\t\tvar pElm = document.createElement('P');\n\t\t\t\t\twhile (node = itemNode.firstChild) {\n\t\t\t\t\t\tpElm.appendChild(node)\n\t\t\t\t\t}\n\n\t\t\t\t\trange.insertNode(pElm);\n\t\t\t\t\trange.setStartAfter(pElm);\n\n\t\t\t\t} else if (part3) {\n\n\t\t\t\t\tpart3ListElm.appendChild(itemNode);\n\t\t\t\t\t\n\t\t\t\t\tif (!part3ListElmInserted) {\n\t\t\t\t\t\trange.insertNode(part3ListElm);\n\t\t\t\t\t\trange.setStartAfter(part3ListElm);\n\t\t\t\t\t\tpart3ListElmInserted = true;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif (itemNode === startNode) {\n\t\t\t\t\tstartNode = pElm;\n\t\t\t\t}\n\t\n\t\t\t\tif (itemNode === endNode) {\n\t\t\t\t\tendNode = pElm;\n\t\t\t\t}\n\n\t\t\t\n\n\t\t\t\tif (part3Will) {\n\t\t\t\t\tpart1 = false;\n\t\t\t\t\tpart2 = false;\n\t\t\t\t\tpart3 = true;\n\t\t\t\t}\n\t\t\t\n\n\t\t\t\titemNode = nextNode;\n\n\n\t\t\t}\n\n\t\t\tif (this.domManager.editor.contains(listElm)) {\n\t\t\t\tthis.domManager.editor.removeChild(listElm);\n\t\t\t}\n\t\t\t\n\n\t\t}\n\n\n\t\tconsole.log(startNode, endNode);\n\n\t\tvar keepRange = document.createRange();\n\t\tkeepRange.setStart(startNode, startOffset);\n\t\tkeepRange.setEnd(endNode, endOffset);\n\n\t\tthis.replaceRange(keepRange);\n\n\t\tthis.fixSelection();\n\n\t}\n\n\tlink(url)\n\t{\n\t\tvar range = this.getRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\treturn;\n\t\t}\n\n\n\n\t\tdocument.execCommand('createLink', false, url);\n\t}\n\n\tblockquote()\n\t{\n\t\tlet orgRange = this.getRange();\n\t\tif (!orgRange) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet startNode = orgRange.startContainer;\n\t\tlet startOffset = orgRange.startOffset;\n\t\tlet endNode = orgRange.endContainer;\n\t\tlet endOffset = orgRange.endOffset;\n\t\tlet chunks = this.getAllNodesInSelection();\n\n\t\tvar isAllBlockquote = true;\n\n\t\tfor (var i = 0; i < chunks.length; i++) {\n\n\t\t\tif (chunks[i].nodeName === \"BLOCKQUOTE\") {\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tisAllBlockquote = false;\n\t\t\t}\n\n\t\t\t// if (chunks[i].textContent === \"\") {\n\t\t\t// \tcontinue;\n\t\t\t// }\n\n\t\t\tif (!this.isParagraph(chunks[i]) && !this.isHeading(chunks[i])) {\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar changedNode = this.changeNodeName(chunks[i], \"blockquote\", false);\n\t\t\tif (chunks[i] === startNode) {\n\t\t\t\tstartNode = changedNode;\n\t\t\t}\n\t\t\tif (chunks[i] === endNode) {\n\t\t\t\tendNode = changedNode;\n\t\t\t}\n\n\t\t}\n\n\t\t// Selection is all blockquote\n\t\tif (isAllBlockquote) {\n\t\t\tfor (var i = 0; i < chunks.length; i++) {\n\t\t\t\tvar changedNode = this.changeNodeName(chunks[i], \"P\", false);\n\t\t\t\tif (chunks[i] === startNode) {\n\t\t\t\t\tstartNode = changedNode;\n\t\t\t\t}\n\t\t\t\tif (chunks[i] === endNode) {\n\t\t\t\t\tendNode = changedNode;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tvar keepRange = document.createRange();\n\t\tkeepRange.setStart(startNode, startOffset);\n\t\tkeepRange.setEnd(endNode, endOffset);\n\t\tthis.replaceRange(keepRange);\n\t}\n\n\n\t/**\n\t * Backspace implementation\n\t */\n\tbackspace(e)\n\t{\n\n\t\t// Get current available node\n\t\tvar currentNode = this.getNodeInSelection();\n\n\t\tvar range = this.getRange();\n\t\tif (!range.collapsed) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tthis.removeSelection(\"start\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Backspace key - Empty node\n\t\tif (currentNode && this.isAvailableEmptyNode(currentNode)) {\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getPreviousAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tvar previousNode = this.getPreviousAvailableNode(currentNode);\n\n\t\t\t\tconsole.log(\"empty child node or parent node\");\n\n\t\t\t\tif (this.isAvailableEmptyNode(previousNode)) {\n\t\t\t\t\tpreviousNode.parentNode.removeChild(previousNode);\n\t\t\t\t} else {\n\t\t\t\t\tvar range = document.createRange();\n\t\t\t\t\trange.setStartAfter(previousNode.lastChild);\n\t\t\t\t\tthis.replaceRange(range);\n\n\t\t\t\t\tif (this.isAvailableChildNode(currentNode)) {\n\t\t\t\t\t\tvar parentNode = currentNode.parentNode;\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t\tconsole.log(parentNode.querySelectorAll(\"LI\"));\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t\n\n\n\t\t\t} else {\n\t\t\t\tif (this.isListItem(currentNode)) {\n\t\t\t\t\tthis.list(currentNode.parentNode.nodeName);\n\t\t\t\t} else if (this.isAvailableParentNode(currentNode)) {\n\t\t\t\t\tthis.changeNodeName(currentNode, \"P\");\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\n\t\t} else if (currentNode && this.getSelectionPositionInParagraph() === 1) {\n\n\t\t\t// backspace - caret position at start of the node\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconsole.log(\"move this line to previous line\");\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getPreviousAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tconsole.log(\"child node or parentnode\");\n\n\t\t\t\tvar previousNode = this.getPreviousAvailableNode(currentNode);\n\n\t\t\t\tif (this.isAvailableEmptyNode(previousNode)) {\n\t\t\t\t\tpreviousNode.parentNode.removeChild(previousNode);\n\t\t\t\t} else {\n\n\n\t\t\t\t\tvar node, orgRange = this.getRange();\n\n\t\t\t\t\tvar startNode = orgRange.startContainer, startOffset = orgRange.startOffset;\n\t\t\t\t\tvar endNode = orgRange.endContainer, endOffset = orgRange.endOffset;\n\n\t\t\t\t\tvar br = previousNode.querySelector(\"br\");\n\t\t\t\t\tif (br) {\n\t\t\t\t\t\tbr.parentNode.removeChild(br);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isAvailableChildNode(currentNode)) {\n\t\t\t\t\t\tvar parentNode = currentNode.parentNode;\n\t\t\t\t\t\tthis.mergeNodes(previousNode, currentNode, true);\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.mergeNodes(previousNode, currentNode, true);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t\t\n\n\t\t\t}\n\n\t\t}\n\t\t\n\n\t}\n\n\tdelete(e)\n\t{\n\t\t// Get current available node\n\t\tvar currentNode = this.getNodeInSelection();\n\n\t\tvar range = this.getRange();\n\t\tif (!range.collapsed) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tthis.removeSelection(\"start\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Delete key - Empty node\n\t\tif (currentNode && currentNode.textContent.length === 0) {\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getNextAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tvar nextNode = this.getNextAvailableNode(currentNode);\n\n\t\t\t\tconsole.log(\"empty child node or parent node\");\n\n\t\t\t\tif (nextNode) {\n\t\t\t\t\tvar range = document.createRange();\n\t\t\t\t\trange.setStartBefore(nextNode.firstChild);\n\t\t\t\t\tthis.replaceRange(range);\n\n\t\t\t\t\tif (this.isAvailableChildNode(currentNode)) {\n\t\t\t\t\t\tvar parentNode = currentNode.parentNode;\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentNode.parentNode.removeChild(currentNode);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tvar range = document.createRange();\n\t\t\t\trange.setStart(currentNode, 0);\n\t\t\t\trange.setEnd(currentNode, 0);\n\t\t\t\tthis.replaceRange(range);\n\t\t\t}\n\n\t\t} else if (currentNode && this.getSelectionPositionInParagraph() === 3) {\n\n\t\t\t// Delete key - caret position at start of the node\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tconsole.log(\"pull the next node to current.\");\n\n\t\t\tif (\n\t\t\t\t(this.isAvailableChildNode(currentNode) ||\n\t\t\t\tthis.isAvailableParentNode(currentNode)) &&\n\t\t\t\tthis.getNextAvailableNode(currentNode)\n\t\t\t) {\n\n\t\t\t\tvar nextNode = this.getNextAvailableNode(currentNode);\n\n\t\t\t\tif (nextNode) {\n\n\t\t\t\t\tvar br = nextNode.querySelector(\"br\");\n\t\t\t\t\tif (br) {\n\t\t\t\t\t\tbr.parentNode.removeChild(br);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isAvailableChildNode(nextNode)) {\n\t\t\t\t\t\tvar parentNode = nextNode.parentNode;\n\t\t\t\t\t\tthis.mergeNodes(currentNode, nextNode, true);\n\t\t\t\t\t\tif (this.isList(parentNode) && parentNode.querySelectorAll(\"LI\").length === 0) {\n\t\t\t\t\t\t\tparentNode.parentNode.removeChild(parentNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.mergeNodes(currentNode, nextNode, true);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t}\n\n\n\t/**\n\t * Prevents default action and implements a return(enter) key press.\n\t */\n\tenter(e)\n\t{\n\t\t\n\n\t\t// When press return key\n\t\tvar selectionNode = this.getNodeInSelection();\n\t\tvar range = this.getRange();\n\t\tif (!range.collapsed) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tthis.removeSelection();\n\t\t\t// this.backspace(e);\n\t\t\tconsole.log(this.getRange());\n\t\t\tconsole.log(\"the range is not collapsed\");\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log(selectionNode);\n\n\t\tvar selPosType = this.getSelectionPositionInParagraph();\n\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\n\t\tif (selPosType === 2) {\n\t\t\tconsole.log('middle');\n\t\t\tthis.splitElementNode();\n\t\t} else if (selPosType === 1) {\n\t\t\tconsole.log('start');\n\t\t\tvar pElm = this.domManager.generateEmptyNode(selectionNode.nodeName);\n\n\t\t\tselectionNode.parentNode.insertBefore(pElm, selectionNode);\n\t\t} else if (selPosType === 3) {\n\t\t\tconsole.log('end');\n\t\t\tvar newNodeName = selectionNode.nodeName;\n\t\t\tvar parentNode = selectionNode.parentNode;\n\t\t\tvar nextNode = selectionNode.nextSibling;\n\n\t\t\tif (\n\t\t\t\tthis.isBlockquote(selectionNode) ||\n\t\t\t\tthis.isHeading(selectionNode)\n\t\t\t) {\n\t\t\t\tnewNodeName = \"P\";\n\t\t\t} else if (this.isListItem(selectionNode)) {\n\t\t\t\tif (this.isEmptyNode(selectionNode)) {\n\n\t\t\t\t\tthis.list(selectionNode.parentNode.nodeName);\n\t\t\t\t\treturn;\n\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\n\t\t\tvar pElm = this.domManager.generateEmptyNode(newNodeName);\n\n\t\t\tconsole.log(pElm);\n\n\t\t\tconsole.log(parentNode);\n\n\t\t\tparentNode.insertBefore(pElm, nextNode);\n\n\t\t\tvar range = document.createRange();\n\t\t\trange.setStartBefore(pElm.firstChild);\n\t\t\trange.collapse(true);\n\n\t\t\tthis.replaceRange(range);\n\t\t}\n\n\n\t}\n\n\t/**\n\t * Paste refined data to the selection.\n\t * @param {String} pastedData\n\t */\n\tpaste(pastedData)\n\t{\n\n\t\tlet splitted = pastedData.split(/(?:\\r\\n|\\r|\\n)/g);\n\n\t\tvar range = document.createRange();\n\t\trange = this.getRange();\n\n\t\tsplitted.forEach( (paragraph, index) => {\n\n\t\t\tvar addedNode;\n\n\t\t\tvar line = paragraph;\n\n\t\t\tif (index === 0) {\n\t\t\t\t// line = line.replace(/\\s/g, \"&nbsp;\");\n\t\t\t\taddedNode = document.createTextNode(line);\n\t\t\t} else {\n\t\t\t\taddedNode = document.createElement('p');\n\t\t\t\tline = line.replace(/\\s/g, \"&nbsp;\");\n\t\t\t\tif (line === \"\") {\n\t\t\t\t\tline = \"<br>\";\n\t\t\t\t}\n\t\t\t\taddedNode.innerHTML = line;\n\t\t\t}\n\n\t\t\trange.insertNode(addedNode);\n\n\t\t\trange.setStartAfter(addedNode);\n\n\t\t});\n\n\t\t// console.log(splitted);\n\n\t\t// pastedData = pastedData.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\n \n\t}\n\n\n\n\tclearRange()\n\t{\n\t\tdocument.getSelection().removeAllRanges();\n\t}\n\n\t/**\n\t * \n\t * @param {Range} range \n\t */\n\treplaceRange(range)\n\t{\n\t\tif (!range) {\n\t\t\tconsole.warn(\"range is not available.\", range);\n\t\t\treturn;\n\t\t}\n\t\tdocument.getSelection().removeAllRanges();\n\t\tdocument.getSelection().addRange(range);\n\t}\n\n\t/**\n\t * Replace the node if the node is inside the editor,\n\t * else return the new node.\n\t * @param {HTMLElement} targetNode An HTML element you want to change its node name.\n\t * @param {String} newNodeName New node name for the target element.\n\t */\n\tchangeNodeName(targetNode, newNodeName, keepStyle = true)\n\t{\n\n\t\t// Move all the nodes inside the target node\n\t\t// to the new generated node with new node name,\n\t\t// as well as preserving the range\n\t\t// if the startContainer or the endContainer are included\n\t\t// in the original node.\n\n\t\tif (targetNode.nodeType !== 1) {\n\t\t\t// If the node is not an HTML element do nothing.\n\t\t\treturn;\n\t\t}\n\n\t\t// 1. Change node\n\t\tvar node;\n\t\tvar newNode = document.createElement(newNodeName);\n\n\t\tif (keepStyle) {\n\t\t\tnewNode.style.textAlign = targetNode.style.textAlign;\n\t\t}\n\t\t\n\n\t\twhile (node = targetNode.firstChild) {\n\t\t\tnewNode.appendChild(node);\n\t\t}\n\n\t\t// 3. replace node\n\t\ttargetNode.parentNode.replaceChild(newNode, targetNode);\n\n\t\treturn newNode;\n\n\t}\n\n\t/**\n\t * Update selection information.\n\t */\n\tupdateSelection()\n\t{\n\n\n\t}\n\n\tfixSelection()\n\t{\n\t\t\n\t\t// If the selection is not in the available elements\n\t\t// adjust it.\n\t\tvar range = this.getRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\n\t\tvar startNode = range.startContainer;\n\t\tvar startOffset = range.startOffset;\n\t\tvar endNode = range.endContainer;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar orgS = startNode;\n\t\tvar orgSO = startOffset;\n\t\tvar orgE = endNode;\n\t\tvar orgEO = endOffset;\n\n\t\tvar target;\n\n\t\tvar newRange = document.createRange();\n\t\tnewRange.setStart(startNode, startOffset);\n\t\tnewRange.setEnd(endNode, endOffset);\n\n\t\tvar isChanged = false;\n\n\t\t// if (startNode.id === 'editor-body') {\n\t\tif (startNode === this.domManager.editor) {\n\n\t\t\ttarget = startNode.firstElementChild;\n\n\t\t\tfor (var i = 0; i < startOffset; i++) {\n\t\t\t\ttarget = target.nextElementSibling;\n\t\t\t}\n\n\t\t\t\n\n\t\t\tif (target) {\n\n\t\t\t\tstartNode = target;\n\t\t\t\tnewRange.setStart(startNode, 0);\n\n\t\t\t\tisChanged = true;\n\t\t\t}\n\n\t\t\t\n\n\t\t}\n\n\n\t\t// if (endNode.id === 'editor-body') {\n\t\tif (endNode === this.domManager.editor) {\n\n\n\t\t\ttarget = endNode.firstChild;\n\n\t\t\tfor (var i = 0; i < endOffset - 1; i++) {\n\t\t\t\ttarget = target.nextElementSibling;\n\t\t\t}\n\n\t\t\tif (target) {\n\t\t\t\tendNode = target;\n\n\t\t\t\tnewRange.setEnd(endNode, 1);\n\n\t\t\t\tisChanged = true;\n\t\t\t}\n\t\t\t\n\n\t\t}\n\n\n\n\t\tvar travelNode;\n\n\t\tif (this.isTextContainNode(startNode)) {\n\n\n\n\t\t\tif (startOffset === 0) {\n\t\t\t\ttravelNode = startNode.firstChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tstartNode = travelNode;\n\t\t\t\t\t\tnewRange.setStart(startNode, 0);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.firstChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (startOffset > 0) {\n\t\t\t\ttravelNode = startNode.lastChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tstartNode = travelNode;\n\t\t\t\t\t\tnewRange.setStart(startNode, startNode.textContent.length);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.lastChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\n\n\t\t}\n\n\t\tif (this.isTextContainNode(endNode)) {\n\n\t\t\t\n\n\t\t\tif (endOffset > 0) {\n\t\t\t\ttravelNode = endNode.lastChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tendNode = travelNode;\n\t\t\t\t\t\tnewRange.setEnd(endNode, endNode.textContent.length);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.lastChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (endOffset === 0) {\n\t\t\t\ttravelNode = endNode.firstChild;\n\t\t\t\twhile (1) {\n\t\t\t\t\tif (!travelNode) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\t\tendNode = travelNode;\n\t\t\t\t\t\tnewRange.setEnd(endNode, 0);\n\t\t\t\t\t\tisChanged = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttravelNode = travelNode.firstChild;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\n\n\t\t}\n\n\n\n\t\tif (isChanged) {\n\t\t\t// console.log(orgS, orgSO);\n\t\t\t// console.log(orgE, orgEO);\n\t\t\t// console.log(orgS, orgSO);\n\t\t\t// console.log(orgE, orgEO);\n\t\t\t// console.log(\"fixed selection\");\n\t\t\t// console.log(newRange.startContainer, newRange.startOffset);\n\t\t\t// console.log(newRange.endContainer, newRange.endOffset);\n\t\t\tthis.replaceRange(newRange);\n\t\t}\n\n\t\tstartNode = this.getRange().startContainer;\n\t\tstartOffset = this.getRange().startOffset;\n\t\tif (startNode.nodeType === 3 && startNode.textContent === \"\") {\n\t\t\tstartNode.parentNode.normalize();\n\t\t}\n\t\t\n\t\t\n\t}\n\n\n\t/**\n\t * Implementing return(enter) key inside blockquotes.\n\t */\n\tsplitElementNode()\n\t{\n\n\t\tvar range;\n\n\t\trange = this.getRange();\n\t\t\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar startNode = range.startContainer;\n\t\tvar startOffset = range.startOffset;\n\t\tvar endNode = range.endContainer;\n\t\tvar endOffset = range.endOffset;\n\n\t\tvar frontNode, backNode;\n\t\tvar backNodePassed = false;\n\n\t\tvar travelNode = startNode;\n\n\t\tvar tempNode, nextNode;\n\n\t\tvar orgNode;\n\t\tvar newNode;\n\n\t\t// Loop from the bottom to the top of the node.\n\t\tvar count = 0;\n\t\twhile (1) {\n\n\t\t\tif (this.isAvailableParentNode(travelNode)) {\n\t\t\t\tbreak;\n\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\n\t\t\t\tif (this.getSelectionPosition() === 1) {\n\t\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t\t\tbackNode = startNode.parentElement;\n\t\t\t\t\tstartNode = backNode.previousSibling;\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tif (startOffset === 0) {\n\t\t\t\t\t\tfrontNode = startNode.previousSibling;\n\t\t\t\t\t\tbackNode = startNode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.splitTextNode();\n\t\t\t\t\t\tfrontNode = startNode;\n\t\t\t\t\t\tbackNode = frontNode.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t} else if (this.isTextStyleNode(travelNode)) {\n\n\t\t\t\tif (frontNode === undefined) {\n\n\t\t\t\t}\n\n\t\t\t\tif (backNode === undefined) {\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\torgNode = travelNode.parentElement;\n\t\t\t\n\t\t\tnewNode = document.createElement(orgNode.nodeName);\n\n\t\t\ttempNode = orgNode.firstChild;\n\n\t\t\tif (!frontNode) {\n\t\t\t\tfrontNode = backNode.previousSibling;\n\t\t\t}\n\n\t\t\tif (!backNode) {\n\t\t\t\tbackNode = frontNode.nextSibling;\n\t\t\t}\n\n\t\t\tconsole.log('-------------------');\n\t\t\tconsole.log(frontNode, backNode, newNode);\n\n\t\t\twhile (1) {\n\t\t\t\t\n\t\t\t\tif (!tempNode) {\n\t\t\t\t\tbackNodePassed = false;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tnextNode = tempNode.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tif (tempNode === backNode) {\n\t\t\t\t\tbackNodePassed = true;\n\t\t\t\t}\n\n\t\t\t\tif (backNodePassed) {\n\t\t\t\t\tnewNode.appendChild(tempNode);\n\t\t\t\t}\n\n\t\t\t\ttempNode = nextNode;\n\n\t\t\t}\n\n\t\t\tif (this.isEmptyNode(orgNode)) {\n\t\t\t\torgNode.parentNode.removeChild(orgNode);\n\t\t\t\torgNode = null;\n\t\t\t}\n\n\t\t\tif (!this.isEmptyNode(newNode)) {\n\t\t\t\torgNode.parentNode.insertBefore(newNode, orgNode.nextSibling);\n\t\t\t} else {\n\t\t\t\tnewNode = null;\n\t\t\t}\n\n\t\t\tfrontNode = orgNode;\n\t\t\tbackNode = newNode;\n\n\n\t\t\t// If there is a newNode inserted,\n\t\t\t// move a range to it.\n\t\t\tif (newNode) {\n\t\t\t\trange.setStart(newNode, 0);\n\t\t\t\tthis.replaceRange(range);\n\t\t\t}\n\t\t\t\n\t\t\t\n\n\t\t\ttravelNode = travelNode.parentElement;\n\n\t\t}\n\n\t}\n\n\tmergeNodes(first, second, matchTopNode = false)\n\t{\n\t\tconsole.log(\"merge method runs\");\n\n\t\tif (!first || !second) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar front = first, back = second;\n\t\tvar tempNode;\n\t\tvar nextFront, nextBack;\n\n\t\tvar range = window.getSelection().getRangeAt(0);\n\t\tvar startNode = this.getTextNodeInElementNode(first, \"last\");\n\t\tvar startOffset;\n\t\tif (startNode) {\n\t\t\tstartOffset = startNode.textContent.length;\n\t\t} else {\n\t\t\tstartNode = this.getTextNodeInElementNode(second, \"first\");\n\t\t\tif (startNode) {\n\t\t\t\tstartOffset = 0;\n\t\t\t}\n\t\t}\n\n\t\t\n\n\t\twhile (1) {\n\n\t\t\tconsole.log(\"front: \", front, \" back: \", back);\n\n\t\t\tif (!front || !back) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (front.nodeName !== back.nodeName) {\n\t\t\t\tif (\n\t\t\t\t\tfront === first &&\n\t\t\t\t\tback === second &&\n\t\t\t\t\tmatchTopNode\n\t\t\t\t) {\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\n\t\t\tif (front.nodeType === 3) {\n\n\t\t\t\tfront.textContent += back.textContent;\n\t\t\t\tback.parentNode.removeChild(back);\n\n\t\t\t\tif (front.textContent === \"\" || back.textContent === \"\") {\n\n\t\t\t\t\tif (front.textContent === \"\") {\n\t\t\t\t\t\tfront = front.previousSibling;\n\t\t\t\t\t\tfront.parentNode.removeChild(front);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (back.textContent === \"\") {\n\t\t\t\t\t\tback = back.nextSibling;\n\t\t\t\t\t\tback.parentNode.removeChild(back);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t\n\n\t\t\t\tbreak;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.log(\"here\");\n\n\t\t\t\tnextFront = front.lastChild;\n\t\t\t\tnextBack = back.firstChild;\n\n\t\t\t\twhile (tempNode = back.firstChild) {\n\t\t\t\t\tfront.appendChild(tempNode);\n\t\t\t\t}\n\n\t\t\t\tback.parentNode.removeChild(back);\n\n\t\t\t\tfront = nextFront;\n\t\t\t\tback = nextBack;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif (startNode) {\n\t\t\tvar keepRange = document.createRange();\n\t\t\tkeepRange.setStart(startNode, startOffset);\n\t\t\tkeepRange.setEnd(startNode, startOffset);\n\t\t\tthis.replaceRange(keepRange);\n\t\t}\n\t\t\n\n\t}\n\n\t/**\n\t * Splits text nodes based on the selection and\n\t * returns start and end node.\n\t * @return {Object.<Text>}\n\t */\n\tsplitTextNode()\n\t{\n\t\tvar range = this.getRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tvar startNode = range.startContainer;\n\t\tvar startOffset = range.startOffset;\n\n\t\tvar returnNode = {\n\t\t\tstartNode: null,\n\t\t\tendNode: null\n\t\t}\n\n\t\treturnNode.startNode = startNode;\n\t\t\n\t\t// Split start of the range.\n\t\tif (\n\t\t\tstartNode.nodeType === 3 &&\n\t\t\tstartOffset > 0 &&\n\t\t\tstartOffset < startNode.textContent.length\n\t\t) {\n\t\t\t\n\t\t\treturnNode.startNode = startNode.splitText(startOffset);\n\n\t\t}\n\n\t\trange = this.getRange();\n\t\tvar endNode = range.endContainer;\n\t\tvar endOffset = range.endOffset;\n\n\t\treturnNode.endNode = endNode;\n\n\t\t// Split end of the range.\n\t\tif (\n\t\t\tstartNode !== endNode &&\n\t\t\tendNode.nodeType === 3 &&\n\t\t\tendOffset < endNode.textContent.length\n\t\t) {\n\n\t\t\tendNode.splitText(endOffset);\n\n\t\t}\n\n\t\treturn returnNode;\n\n\t}\n\n\t/**\n\t * Remove selection.\n\t */\n\tremoveSelection(collapseDirection = \"end\")\n\t{\n\t\tvar range = this.getRange();\n\t\tvar orgRange = range.cloneRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar splitResult = this.splitTextNode();\n\n\t\tvar startNode = splitResult.startNode;\n\t\tvar endNode = splitResult.endNode;\n\t\t\n\t\tvar deletionDone = false;\n\t\tvar selectionNode = this.getNodeInSelection();\n\t\tvar nextParentNode = this.getNextAvailableNode(selectionNode);\n\n\t\t// range.collapse(false);\n\n\t\trange.setStart(range.endContainer, range.endOffset);\n\t\tthis.replaceRange(range);\n\t\t\n\n\t\tvar currentParentNode = selectionNode;\n\t\tvar travelNode = startNode;\n\t\tvar nextNode;\n\t\tvar parentNode;\n\n\t\twhile (1) {\n\t\t\tif (\n\t\t\t\t!currentParentNode.contains(startNode) &&\n\t\t\t\t!currentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\tconsole.log(\"nothing contains\");\n\t\t\t\tconsole.log(currentParentNode.textContent);\n\t\t\t\tcurrentParentNode.parentNode.removeChild(currentParentNode);\n\t\t\t} else if (\n\t\t\t\tcurrentParentNode.contains(startNode) &&\n\t\t\t\t!currentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\ttravelNode = startNode;\n\t\t\t\tconsole.log(\"only contains startnode\");\n\t\t\t\tconsole.log(currentParentNode.textContent);\n\t\t\t\tvar metCurrentNode = false;\n\n\t\t\t\tvar tempRange = document.createRange();\n\t\t\t\ttempRange.setStart(startNode, 0);\n\t\t\t\ttempRange.setEndAfter(currentParentNode.lastChild);\n\n\t\t\t\ttempRange.deleteContents();\n\n\t\t\t\tif (this.isTextEmptyNode(currentParentNode)) {\n\t\t\t\t\tcurrentParentNode.innerHTML = \"\";\n\t\t\t\t\tcurrentParentNode.appendChild(document.createElement(\"br\"));\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\t!currentParentNode.contains(startNode) &&\n\t\t\t\tcurrentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\ttravelNode = endNode;\n\t\t\t\tconsole.log(\"only contains endnode\");\n\t\t\t\tconsole.log(currentParentNode.textContent);\n\n\n\t\t\t\tvar tempRange = document.createRange();\n\t\t\t\ttempRange.setStartBefore(currentParentNode.firstChild);\n\t\t\t\ttempRange.setEnd(endNode, orgRange.endOffset);\n\n\t\t\t\ttempRange.deleteContents();\n\n\t\t\t\tif (this.isTextEmptyNode(currentParentNode)) {\n\t\t\t\t\tcurrentParentNode.innerHTML = \"\";\n\t\t\t\t\tcurrentParentNode.appendChild(document.createElement(\"br\"));\n\t\t\t\t}\n\t\t\t\tif (collapseDirection === \"start\") {\n\t\t\t\t\tthis.backspace(document.createEvent(\"KeyboardEvent\")); \n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t} else if (\n\t\t\t\tcurrentParentNode.contains(startNode) &&\n\t\t\t\tcurrentParentNode.contains(endNode)\n\t\t\t) {\n\t\t\t\ttravelNode = startNode;\n\t\t\t\torgRange.deleteContents();\n\t\t\t\tif (this.isTextEmptyNode(currentParentNode)) {\n\t\t\t\t\tcurrentParentNode.innerHTML = \"\";\n\t\t\t\t\tcurrentParentNode.appendChild(document.createElement(\"br\"));\n\t\t\t\t}\n\n\t\t\t\tconsole.log(startNode);\n\t\t\t\tconsole.log(endNode);\n\n\t\t\t\tif (collapseDirection === \"end\") {\n\t\t\t\t\tthis.enter(document.createEvent(\"KeyboardEvent\")); \n\t\t\t\t}\n\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcurrentParentNode = nextParentNode;\n\t\t\tnextParentNode = this.getNextAvailableNode(nextParentNode);\n\t\t}\n\n\t\t// this.fixSelection();\n\n\n\n\t}\n\n\t/**\n\t * Return true if the selection is empty.\n\t */\n\tisEmpty()\n\t{\n\t\tif (document.getSelection().isCollapsed) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\n\n\n\t/**\n\t * If there isn't any of child nodes including \"\" text nodes, returns true.\n\t * And truly clear the node to real empty.\n\t * @param {HTMLElement} node \n\t */\n\tisEmptyNode(node)\n\t{\n\n\t\tif (node.nodeType === 3) {\n\t\t\treturn false;\n\t\t}\n\t\tvar travelNode = node.firstChild;\n\t\tvar nextNode = travelNode;\n\n\t\twhile (1) {\n\n\t\t\tif (!travelNode) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tnextNode = travelNode.nextSibling;\n\n\t\t\tif (travelNode.nodeType === 3 && travelNode.textContent === \"\") {\n\t\t\t\tnode.removeChild(travelNode);\n\t\t\t} else if (travelNode.nodeName !== \"BR\") {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\ttravelNode = nextNode;\n\n\t\t}\n\t}\n\n\tisTextEmptyNode(node)\n\t{\n\t\tif (node.nodeType === 3) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tnode.textContent === \"\" &&\n\t\t\t!(node.querySelector(\"br\"))\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisAvailableEmptyNode(node) {\n\t\tif (node.nodeType === 3) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tnode.textContent === \"\" &&\n\t\t\tnode.querySelector(\"br\")\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisTextContainNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isParagraph(node) ||\n\t\t\tthis.isHeading(node)   ||\n\t\t\tthis.isList(node)      ||\n\t\t\tthis.isListItem(node)  ||\n\t\t\tthis.isBlockquote(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisTextStyleNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isBold(node) ||\n\t\t\tthis.isItalics(node)   ||\n\t\t\tthis.isStrike(node)      ||\n\t\t\tthis.isUnderline(node)  ||\n\t\t\tthis.isLink(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisBold(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'B' ||\n\t\t\tnode.nodeName === 'STRONG'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisItalics(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'I' ||\n\t\t\tnode.nodeName === 'EM'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisStrike(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'STRIKE') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisUnderline(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'U') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisLink(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'LINK') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Determine if the given node is a paragraph node which Povium understands.\n\t * @param {Node} node\n\t */\n\tisParagraph(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'P') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisHeading(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'H1' ||\n\t\t\tnode.nodeName === 'H2' ||\n\t\t\tnode.nodeName === 'H3' ||\n\t\t\tnode.nodeName === 'H4' ||\n\t\t\tnode.nodeName === 'H5' ||\n\t\t\tnode.nodeName === 'H6'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisList(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (\n\t\t\tnode.nodeName === 'OL' ||\n\t\t\tnode.nodeName === 'UL'\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisListItem(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'LI') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisBlockquote(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.nodeName === 'BLOCKQUOTE') {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Returns true if the node is an available image block.\n\t * @param {HTMLElement} node \n\t */\n\tisImageBlock(node)\n\t{\n\t\tif (!node) {\n\t\t\treturn false;\n\t\t} else if (node.classList && node.classList.contains('image-block')) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisAvailableParentNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isParagraph(node) ||\n\t\t\tthis.isHeading(node) ||\n\t\t\tthis.isList(node) ||\n\t\t\tthis.isBlockquote(node) ||\n\t\t\tthis.isImageBlock(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tisAvailableChildNode(node)\n\t{\n\t\tif (\n\t\t\tthis.isListItem(node)\n\t\t) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\n\t/**\n\t * Get the first or last text node inside the HTMLElement\n\t * @param {HTMLElement} node\n\t * @param {String} firstOrLast\n\t * \"first\" | \"last\" \n\t */\n\tgetTextNodeInElementNode(node, firstOrLast)\n\t{\n\t\tvar travelNode = node;\n\t\tvar returnNode = null;\n\t\tif (!node) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (firstOrLast === \"first\") {\n\t\t\twhile (1) {\n\t\t\t\tif (travelNode === null) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\treturnNode = travelNode;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.firstChild;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (firstOrLast === \"last\") {\n\t\t\twhile (1) {\n\t\t\t\tif (travelNode === null) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.nodeType === 3) {\n\t\t\t\t\treturnNode = travelNode;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.lastChild;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.error(\"Second parameter must be 'first' or 'last'.\");\n\t\t}\n\n\t\treturn returnNode;\n\t\t\n\t}\n\n\tgetSelectionPosition(customRange = null)\n\t{\n\n\t\tvar orgRange;\n\n\t\tif (customRange) {\n\t\t\torgRange = customRange;\n\t\t} else {\n\t\t\torgRange = this.getRange();\n\t\t}\n\n\t\tif (!orgRange) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar startNode   = orgRange.startContainer;\n\t\tvar startOffset = orgRange.startOffset;\n\t\tvar endNode     = orgRange.endContainer;\n\t\tvar endOffset   = orgRange.endOffset;\n\n\n\t\tvar travelNode;\n\t\tvar isStart = false;\n\t\tvar isEnd   = false;\n\n\n\t\ttravelNode = startNode.previousSibling;\n\n\t\twhile (1) {\n\t\t\tif (!travelNode && startOffset === 0) {\n\t\t\t\tisStart = true;\n\t\t\t\tbreak;\n\t\t\t} else if (!travelNode) {\n\t\t\t\tbreak;\n\t\t\t} else if (travelNode.textContent === \"\") {\n\t\t\t\ttravelNode = travelNode.previousSibling;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\n\n\t\ttravelNode = endNode.nextSibling;\n\n\t\twhile (1) {\n\t\t\tif (!travelNode && endOffset === endNode.textContent.length) {\n\t\t\t\tisEnd = true;\n\t\t\t\tbreak;\n\t\t\t} else if (!travelNode) {\n\t\t\t\tbreak;\n\t\t\t} else if (travelNode.textContent === \"\") {\n\t\t\t\ttravelNode = travelNode.nextSibling;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\n\t\tif (startNode === endNode && this.isEmptyNode(startNode)) {\n\t\t\tisEnd = true;\n\t\t}\n\n\t\tif (isStart) {\n\t\t\treturn 1;\n\t\t} else if (isEnd) {\n\t\t\treturn 3;\n\t\t} else {\n\t\t\treturn 2;\n\t\t}\n\n\t}\n\n\tgetSelectionPositionInParagraph(customRange = null)\n\t{\n\t\tvar orgRange;\n\n\t\tif (customRange) {\n\t\t\torgRange = customRange;\n\t\t} else {\n\t\t\torgRange = this.getRange();\n\t\t}\n\n\t\tif (!orgRange) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar startNode   = orgRange.startContainer;\n\t\tvar startOffset = orgRange.startOffset;\n\t\tvar endNode     = orgRange.endContainer;\n\t\tvar endOffset   = orgRange.endOffset;\n\n\n\t\tvar travelNode, parentNode;\n\t\tvar isStart = false;\n\t\tvar isEnd   = false;\n\n\n\t\tparentNode = startNode.parentElement;\n\t\ttravelNode = startNode;\n\t\t\n\t\tif (startOffset === 0) {\n\t\t\twhile (1) {\n\t\t\t\tif (\n\t\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t\t) {\n\t\t\t\t\tisStart = true;\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.previousSibling) {\n\t\t\t\t\tif (travelNode.previousSibling.textContent === \"\" || travelNode.previousSibling.nodeName === \"BR\") {\n\t\t\t\t\t\ttravelNode = travelNode.previousSibling;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisStart = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\n\n\t\tparentNode = endNode.parentElement;\n\t\ttravelNode = endNode;\n\t\tif (endOffset === endNode.textContent.length) {\n\t\t\twhile (1) {\n\t\t\t\tif (\n\t\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t\t) {\n\t\t\t\t\tisEnd = true;\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (travelNode.nextSibling) {\n\t\t\t\t\tif (travelNode.nextSibling.textContent === \"\" || travelNode.nextSibling.nodeName === \"BR\") {\n\t\t\t\t\t\ttravelNode = travelNode.nextSibling;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisEnd = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (startNode === endNode && this.isEmptyNode(startNode)) {\n\t\t\tisStart = false;\n\t\t\tisEnd = true;\n\t\t}\n\n\t\tif (isStart) {\n\t\t\treturn 1;\n\t\t} else if (isEnd) {\n\t\t\treturn 3;\n\t\t} else {\n\t\t\treturn 2;\n\t\t}\n\t}\n\n\n\n\t// Getters\n\n\t\n\t/**\n\t * @return {Range}\n\t */\n\tgetRange()\n\t{\n\t\tif (document.getSelection().rangeCount > 0) {\n\t\t\treturn document.getSelection().getRangeAt(0);\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Returns an array of all available nodes within the selection.\n\t * @return {Array.<HTMLElement>}\n\t */\n\tgetAllNodesInSelection()\n\t{\n\n\t\tlet travelNode = this.getRange() ? this.getRange().startContainer : null;\n\t\tlet nodes = [];\n\n\t\twhile (1) {\n\n\n\t\t\tif (!travelNode) {\n\t\t\t\tbreak;\n\t\t\t} else if (this.isAvailableParentNode(travelNode)) {\n\t\t\t\tnodes.push(travelNode);\n\t\t\t\tif (travelNode.contains(this.getRange().endContainer)) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\ttravelNode = travelNode.nextElementSibling;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.parentElement;\n\t\t\t}\n\n\t\t}\n\n\t\treturn nodes;\n\n\t}\n\n\tgetPreviousAvailableNode(node)\n\t{\n\t\tvar previousNode = node;\n\t\tvar travelNode = node.previousSibling;\n\t\tvar returnNode = null;\n\t\twhile (1) {\n\t\t\tif (travelNode === null) {\n\t\t\t\tif (this.isAvailableChildNode(previousNode)) {\n\t\t\t\t\ttravelNode = previousNode.parentNode.previousSibling;\n\t\t\t\t\tpreviousNode = travelNode;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t) {\n\t\t\t\t// Find the available node\n\t\t\t\tif (this.isList(travelNode)) {\n\t\t\t\t\tvar itemNodes = travelNode.querySelectorAll(\"LI\");\n\t\t\t\t\ttravelNode = itemNodes[itemNodes.length - 1];\n\t\t\t\t}\n\t\t\t\treturnNode = travelNode;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.previousSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn returnNode;\n\t}\n\n\tgetNextAvailableNode(node)\n\t{\n\t\tvar previousNode = node;\n\t\tvar travelNode = node.nextSibling;\n\t\tvar returnNode = null;\n\t\twhile (1) {\n\t\t\tif (travelNode === null) {\n\t\t\t\tif (this.isAvailableChildNode(previousNode)) {\n\t\t\t\t\ttravelNode = previousNode.parentNode.nextSibling;\n\t\t\t\t\tpreviousNode = travelNode;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t) {\n\t\t\t\t// Find the available node\n\t\t\t\tif (this.isList(travelNode)) {\n\t\t\t\t\ttravelNode = travelNode.querySelectorAll(\"LI\")[0];\n\t\t\t\t}\n\t\t\t\treturnNode = travelNode;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.nextSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn returnNode;\n\t}\n\n\tgetNodeInSelection()\n\t{\n\n\t\tvar range = this.getRange();\n\t\tif (!range) {\n\t\t\treturn;\n\t\t}\n\t\tvar travelNode = this.getRange().startContainer;\n\t\tif (travelNode === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\twhile (1) {\n\t\t\tif (travelNode === null) {\n\t\t\t\treturn null;\n\t\t\t} else if (\n\t\t\t\tthis.isAvailableParentNode(travelNode) ||\n\t\t\t\tthis.isAvailableChildNode(travelNode)\n\t\t\t) {\n\t\t\t\treturn travelNode;\n\t\t\t} else {\n\t\t\t\ttravelNode = travelNode.parentNode;\n\t\t\t}\n\t\t}\n\n\t}\n\n}","Node.prototype.merge = function (node) {\n\n    \n}"],"sourceRoot":""}